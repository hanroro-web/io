<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, viewport-fit=cover">
    <title>HANRORO 관리자 대시보드</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@100..900&display=swap');
        :root { --vibe-deep: #05020a; --vibe-primary: #8a4fff; }
        
        html { scroll-behavior: smooth; }

        body { 
            font-family: 'Pretendard', sans-serif; 
            background-color: var(--vibe-deep); 
            color: #ffffff; 
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
            width: 100%;
        }

        /* --- 모바일 환경 90% 축소 및 가독성 최적화 --- */
        @media (max-width: 768px) {
            body {
                zoom: 0.9; 
            }
            .content-section {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            .section-title {
                font-size: 1.1rem !important;
            }
            .mobile-card-wrapper {
                padding-bottom: 30px;
            }
            .admin-modal-content {
                zoom: 1; 
            }
        }

        /* 스크롤바 커스텀 */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #0f0a1f; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #8a4fff; }

        .glass-nav { 
            background: rgba(5, 2, 10, 0.85); 
            backdrop-filter: blur(12px); 
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }

        .nav-item {
            position: relative;
            color: #94a3b8;
            font-size: 0.9rem;
            font-weight: 600;
            padding: 8px 16px;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 99px;
        }
        .nav-item:hover, .nav-item.active {
            color: #fff;
            background: rgba(255, 255, 255, 0.1);
        }
        .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: -22px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 2px;
            background: #8a4fff;
            box-shadow: 0 0 10px #8a4fff;
        }

        .gradient-text { background: linear-gradient(90deg, #a78bfa, #c084fc); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .magic-wand-float { animation: wandFloat 3s ease-in-out infinite; display: inline-block; }
        @keyframes wandFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-12px) rotate(12deg); }
        }

        .magic-rain-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.8;
            pointer-events: none;
        }

        .hero-wand-container {
            perspective: 1000px;
            position: absolute;
            right: -5%;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1;
            opacity: 1;
            pointer-events: none;
        }
        
        .hero-wand-3d {
            font-size: clamp(15rem, 40vw, 35rem);
            background: linear-gradient(135deg, #ffffff 0%, #e9d5ff 20%, #a855f7 50%, #7e22ce 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 20px rgba(168, 85, 247, 0.5), 0 0 40px rgba(168, 85, 247, 0.3);
            animation: heroWandFloat 6s ease-in-out infinite;
            transform-style: preserve-3d;
            transform: rotateZ(-15deg) rotateY(15deg);
        }

        @keyframes heroWandFloat {
            0%, 100% { transform: translateY(0) rotateZ(-15deg) rotateY(15deg) scale(1); }
            50% { transform: translateY(-30px) rotateZ(-12deg) rotateY(5deg) scale(1.02); }
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            transition: transform 0.3s ease, border-color 0.3s ease;
        }

        .custom-input { width: 100%; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 10px 14px; color: white; outline: none; transition: border-color 0.2s; font-size: 0.85rem; }
        .custom-input:focus { border-color: #8a4fff; }
        .status-badge { padding: 4px 8px; border-radius: 6px; font-size: 10px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.05em; }
        .status-pending { background: rgba(234, 179, 8, 0.1); color: #fbbf24; border: 1px solid rgba(234, 179, 8, 0.2); }
        .status-complete { background: rgba(138, 79, 255, 0.15); color: #c084fc; border: 1px solid rgba(138, 79, 255, 0.3); }
        .tax-pending { background: rgba(255, 255, 255, 0.1); color: #94a3b8; border: 1px solid rgba(255, 255, 255, 0.1); }
        .tax-complete { background: rgba(52, 211, 153, 0.15); color: #34d399; border: 1px solid rgba(52, 211, 153, 0.3); }

        .table-row { border-bottom: 1px solid rgba(255, 255, 255, 0.05); transition: background 0.2s; }
        .table-row:hover { background: rgba(255, 255, 255, 0.02); }
        .table-head { font-size: 11px; text-transform: uppercase; color: #64748b; font-weight: 700; letter-spacing: 0.05em; padding-bottom: 12px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        .section-title { font-size: 1.25rem; font-weight: 800; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 10px; letter-spacing: -0.02em; }
        .section-title i { color: #8a4fff; font-size: 1rem; }
        
        .unified-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }

        .admin-modal { display: none; position: fixed; inset: 0; z-index: 9999; background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(8px); align-items: center; justify-content: center; padding: 20px; }
        .admin-modal.active { display: flex; }
        .admin-modal-content { background: #0f0a1f; border: 1px solid rgba(255, 255, 255, 0.1); width: 100%; max-width: 600px; border-radius: 20px; padding: 30px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); max-height: 90vh; overflow-y: auto; }

        #login-overlay { position: fixed; inset: 0; background-color: #05020a; z-index: 10000; display: flex; align-items: center; justify-content: center; flex-direction: column; transition: opacity 0.5s ease; }
        #login-overlay.hidden { opacity: 0; pointer-events: none; visibility: hidden; }
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }

        .mobile-drawer-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 60; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
        .mobile-drawer-overlay.active { opacity: 1; pointer-events: auto; }
        .mobile-drawer { position: fixed; top: 0; right: 0; bottom: 0; width: 280px; background: #0f0a1f; border-left: 1px solid rgba(255,255,255,0.1); z-index: 70; transform: translateX(100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: flex; flex-direction: column; padding: 24px; }
        .mobile-drawer.active { transform: translateX(0); }
        .drawer-item { padding: 16px; border-radius: 12px; font-weight: 600; color: #94a3b8; margin-bottom: 4px; transition: all 0.2s; display: flex; items-center; gap: 12px; }
        .drawer-item:hover, .drawer-item.active { background: rgba(138, 79, 255, 0.1); color: white; }

        @media (max-width: 1024px) {
            .hero-wand-container { right: -15%; opacity: 0.7; }
            .hero-wand-3d { font-size: 24rem; }
        }
    </style>
</head>
<body class="min-h-screen overflow-hidden">

    <!-- LOGIN OVERLAY -->
    <div id="login-overlay">
        <div class="glass-panel p-8 rounded-2xl w-full max-w-sm text-center border-t border-purple-500/20 shadow-2xl shadow-purple-900/20">
            <div class="mb-8 flex flex-col items-center">
                <div class="flex items-center gap-2 mb-2">
                    <i class="fas fa-magic text-3xl text-purple-400 magic-wand-float"></i>
                    <span class="text-3xl font-black tracking-tighter gradient-text uppercase">HANRORO</span>
                </div>
                <div class="flex items-center gap-2 text-gray-500 px-3 py-1 rounded-full bg-white/5 border border-white/5">
                    <i class="fas fa-shield-alt text-[10px]"></i>
                    <span class="text-[10px] font-bold uppercase tracking-widest">Admin Access Only</span>
                </div>
            </div>
            
            <form id="login-form" class="space-y-4">
                <input type="password" id="passcode-input" class="custom-input text-center tracking-widest text-lg py-3 bg-black/20 focus:bg-black/40 border-white/10 focus:border-purple-500/50" placeholder="PASSCODE" autofocus required>
                <button type="submit" class="w-full bg-purple-600 hover:bg-purple-500 text-white font-bold py-3.5 rounded-xl transition-all shadow-lg shadow-purple-900/20 uppercase tracking-widest text-xs flex items-center justify-center gap-2 group">
                    <span>시스템 접속하기</span>
                    <i class="fas fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
                </button>
            </form>
            <p id="login-error" class="text-red-400 text-xs mt-4 font-bold hidden bg-red-500/10 py-2 rounded-lg border border-red-500/20"><i class="fas fa-exclamation-triangle mr-1"></i> 패스코드가 올바르지 않습니다.</p>
        </div>
        <div class="absolute bottom-10 text-gray-600 text-[10px] font-mono flex flex-col items-center gap-1 opacity-50">
            <i class="fas fa-lock"></i>
            <span>SECURED BY HANRORO SYSTEM</span>
        </div>
    </div>

    <!-- 네비게이션 -->
    <nav class="fixed w-full z-50 glass-nav h-16 sm:h-20 flex items-center justify-between px-6">
        <div class="flex items-center gap-2 cursor-pointer" onclick="location.reload()">
            <i class="fas fa-magic text-lg text-purple-400 magic-wand-float"></i>
            <div class="text-xl font-black tracking-tighter gradient-text uppercase">HANRORO</div>
        </div>
        <div class="hidden lg:flex items-center gap-2" id="desktop-menu">
            <div class="nav-item active" onclick="showSection('dashboard', this)">대시보드</div>
            <div class="nav-item" onclick="showSection('projects', this)">프로젝트 관리</div>
            <div class="nav-item" onclick="showSection('sales', this)">매출 현황</div>
            <div class="nav-item" onclick="showSection('portfolios', this)">포트폴리오</div>
            <div class="nav-item" onclick="showSection('quotes', this)">견적 문의</div>
            <div class="nav-item" onclick="showSection('deposits', this)">결제 현황</div>
            <div class="nav-item" onclick="showSection('site-config', this)">사이트 설정</div>
        </div>
        <div class="flex items-center gap-4">
            <div class="hidden sm:flex items-center gap-3 px-3 py-1.5 rounded-full bg-white/5 border border-white/10 group relative">
                <div class="w-6 h-6 rounded-full bg-purple-600 flex items-center justify-center font-bold text-[10px]">A</div>
                <span class="text-xs font-bold text-gray-300">관리자</span>
                <button onclick="logout()" class="ml-2 w-6 h-6 flex items-center justify-center rounded-full hover:bg-white/10 text-gray-400 hover:text-red-400 transition-colors">
                    <i class="fas fa-sign-out-alt text-xs"></i>
                </button>
            </div>
            <button class="lg:hidden w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-full transition-colors" onclick="toggleMobileMenu(true)">
                <i class="fas fa-bars text-xl"></i>
            </button>
        </div>
    </nav>

    <!-- 모바일 메뉴 드로어 -->
    <div id="mobile-overlay" class="mobile-drawer-overlay" onclick="toggleMobileMenu(false)"></div>
    <div id="mobile-drawer" class="mobile-drawer">
        <div class="flex items-center justify-between mb-8">
            <span class="font-black text-lg tracking-tight"><i class="fas fa-magic text-purple-500 mr-2"></i>MENU</span>
            <button onclick="toggleMobileMenu(false)" class="text-gray-400 hover:text-white"><i class="fas fa-times text-xl"></i></button>
        </div>
        <div class="flex items-center gap-3 p-4 mb-6 bg-white/5 rounded-xl border border-white/5">
            <div class="w-10 h-10 rounded-full bg-purple-600 flex items-center justify-center font-bold text-sm">A</div>
            <div>
                <div class="font-bold text-sm text-white">Administrator</div>
                <div class="text-[10px] text-gray-400">Master Access</div>
            </div>
        </div>
        <div class="flex-1 space-y-1 overflow-y-auto">
            <div class="drawer-item active" onclick="showSection('dashboard', this)"><i class="fas fa-chart-pie w-5"></i> 대시보드</div>
            <div class="drawer-item" onclick="showSection('projects', this)"><i class="fas fa-tasks w-5"></i> 프로젝트 관리</div>
            <div class="drawer-item" onclick="showSection('sales', this)"><i class="fas fa-chart-line w-5"></i> 매출 현황</div>
            <div class="drawer-item" onclick="showSection('portfolios', this)"><i class="fas fa-briefcase w-5"></i> 포트폴리오</div>
            <div class="drawer-item" onclick="showSection('quotes', this)"><i class="fas fa-file-invoice-dollar w-5"></i> 견적 문의</div>
            <div class="drawer-item" onclick="showSection('deposits', this)"><i class="fas fa-credit-card w-5"></i> 결제 현황</div>
            <div class="drawer-item" onclick="showSection('site-config', this)"><i class="fas fa-sliders-h w-5"></i> 사이트 설정</div>
            <div class="my-4 border-t border-white/5"></div>
            <div class="drawer-item text-red-400 hover:text-red-300" onclick="logout()"><i class="fas fa-sign-out-alt w-5"></i> 로그아웃</div>
        </div>
    </div>

    <!-- 히어로 섹션 -->
    <section class="min-h-screen flex items-center pt-24 pb-20 relative overflow-hidden bg-[#05020a]">
        <canvas id="magic-rain" class="magic-rain-canvas"></canvas>
        <div class="hero-wand-container">
            <i class="fas fa-magic hero-wand-3d"></i>
        </div>
        <div class="absolute bottom-0 left-0 w-full h-32 bg-gradient-to-t from-[#05020a] via-[#05020a] to-transparent z-[5]"></div>

        <div class="max-w-7xl mx-auto px-6 w-full relative z-10">
            <div class="inline-flex items-center px-4 py-1.5 mb-6 rounded-full border border-purple-500/30 bg-purple-500/10 text-purple-300 text-[10px] font-black uppercase tracking-[0.2em]">
                <i class="fas fa-shield-alt mr-2"></i> Administrator Console
            </div>
            <h1 class="text-3xl sm:text-5xl font-black leading-[1.15] mb-6 sm:mb-10 tracking-tighter">
                시스템 관리 및 <br>
                <span class="gradient-text italic">데이터 컨트롤 타워</span>
            </h1>
            <p class="text-white mb-10 text-sm sm:text-lg max-w-xl leading-relaxed font-medium">
                실시간 프로젝트 모니터링, 매출 현황, 그리고 사이트 설정을 위한 통합 대시보드입니다. 모든 데이터는 실시간 동기화됩니다.
            </p>
            <div class="flex flex-wrap items-center gap-3">
                <button onclick="showSection('sales', null)" class="bg-white text-black px-6 py-3 rounded-2xl font-black text-xs uppercase tracking-tight hover:bg-gray-200 transition-colors">
                    <i class="fas fa-chart-line mr-2"></i> 매출 현황 확인
                </button>
                <button onclick="showSection('deposits', null)" class="px-6 py-3 rounded-2xl font-black text-xs uppercase tracking-tight border border-white/20 bg-white/5 backdrop-blur-md text-white hover:bg-white/10 transition-all flex items-center gap-2">
                    <i class="fas fa-credit-card text-purple-400"></i> 결제 현황 확인
                </button>
            </div>
        </div>
    </section>

    <!-- 메인 콘텐츠 영역 -->
    <main class="relative z-20 max-w-7xl mx-auto px-4 sm:px-6 -mt-10 pb-20">
        
        <!-- 1. 대시보드 메인 -->
        <div id="section-dashboard" class="content-section space-y-8">
            <div class="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="glass-panel p-5 rounded-2xl relative overflow-hidden group">
                    <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1">Projects</p>
                    <h3 class="text-3xl font-black" id="stat-active-projects">-</h3>
                    <div class="mt-3 text-[9px] text-gray-500 font-bold uppercase">Active Items</div>
                </div>
                <div class="glass-panel p-5 rounded-2xl relative overflow-hidden group">
                    <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1">Quotes</p>
                    <h3 class="text-3xl font-black text-purple-400" id="stat-new-quotes">-</h3>
                    <div class="mt-3 text-[9px] text-gray-500 font-bold uppercase">Total Inquiries</div>
                </div>
                <div class="glass-panel p-5 rounded-2xl relative overflow-hidden group">
                    <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1">Pending</p>
                    <h3 class="text-3xl font-black text-yellow-500" id="stat-pending-deposits">-</h3>
                    <div class="mt-3 text-[9px] text-gray-500 font-bold uppercase">Wait Payment</div>
                </div>
                <div class="glass-panel p-5 rounded-2xl flex flex-col justify-center items-center gap-2 border-dashed border-2 border-white/10 hover:border-purple-500/50 cursor-pointer" onclick="showSection('sales', null)">
                    <i class="fas fa-chart-line text-xl text-purple-500"></i>
                    <span class="text-[9px] font-bold uppercase tracking-wider">Revenue Detail</span>
                </div>
            </div>
        </div>

        <!-- 2. 프로젝트 관리 -->
        <div id="section-projects" class="content-section hidden">
            <h2 class="section-title"><i class="fas fa-tasks"></i> 프로젝트 관리</h2>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-1">
                    <div class="glass-panel p-6 rounded-2xl sticky top-24">
                        <h3 class="text-sm font-bold text-white mb-4 uppercase tracking-wider flex justify-between">
                            <span id="p-form-title">새 프로젝트 등록</span>
                            <button onclick="resetProjectForm()" class="text-[10px] text-gray-400 hover:text-white hidden" id="p-form-reset">취소</button>
                        </h3>
                        <form id="project-form" class="space-y-4">
                            <input type="hidden" id="p-id">
                            <div><label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">프로젝트명</label><input type="text" id="p-name" class="custom-input" required></div>
                            <div>
                                <label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">진행 단계</label>
                                <select id="p-phase" class="custom-input bg-[#1a1625]">
                                    <option value="상담">상담</option><option value="계약">계약</option><option value="기획">기획</option><option value="디자인">디자인</option><option value="개발">개발</option><option value="테스트">테스트</option><option value="배포">배포</option><option value="최종 배포 완료">최종 배포 완료</option><option value="유지보수">유지보수</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">진행률 (<span id="p-prog-val">0%</span>)</label>
                                <input type="range" id="p-progress" min="0" max="100" value="0" class="w-full h-1.5 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-500" oninput="document.getElementById('p-prog-val').innerText = this.value + '%'">
                            </div>
                            <button type="submit" id="p-submit-btn" class="w-full bg-purple-600 text-white font-bold py-3 rounded-xl transition-colors text-xs uppercase tracking-widest">프로젝트 저장</button>
                        </form>
                    </div>
                </div>
                <div class="lg:col-span-2 space-y-3" id="project-manage-list"></div>
            </div>
        </div>

        <!-- 3. 매출 현황 -->
        <div id="section-sales" class="content-section hidden">
            <h2 class="section-title"><i class="fas fa-chart-line"></i> 매출 현황</h2>
            <p class="text-[10px] sm:text-xs text-gray-500 mb-6 font-bold flex flex-wrap items-center gap-2">
                <span class="px-2 py-0.5 rounded bg-white/5 border border-white/10">상호명: 한로로(55디자이너스)</span>
                <span id="sales-today-date" class="text-purple-400"></span> 기준
            </p>

            <div class="grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-3 sm:gap-6 mb-8">
                <div class="glass-panel p-4 sm:p-6 rounded-2xl relative overflow-hidden bg-gradient-to-br from-white/5 to-transparent">
                    <p class="text-[9px] font-bold text-gray-400 uppercase tracking-widest mb-1"><i class="fas fa-coins mr-1 text-purple-400"></i> 총 매출</p>
                    <h3 class="text-lg sm:text-2xl font-black text-white" id="sales-total-revenue">0원</h3>
                </div>
                <div class="glass-panel p-4 sm:p-6 rounded-2xl relative overflow-hidden">
                    <p class="text-[9px] font-bold text-gray-400 uppercase tracking-widest mb-1"><i class="fas fa-wallet mr-1 text-purple-400"></i> 순수익 (공급가)</p>
                    <h3 class="text-lg sm:text-2xl font-black text-cyan-400" id="sales-net-revenue">0원</h3>
                </div>
                <div class="glass-panel p-4 sm:p-6 rounded-2xl relative overflow-hidden">
                    <p class="text-[9px] font-bold text-gray-400 uppercase tracking-widest mb-1"><i class="fas fa-file-invoice-dollar mr-1 text-purple-400"></i> 부가세</p>
                    <h3 class="text-lg sm:text-2xl font-black text-green-400" id="sales-vat-revenue">0원</h3>
                </div>
                <div class="glass-panel p-4 sm:p-6 rounded-2xl relative overflow-hidden">
                    <p class="text-[9px] font-bold text-gray-400 uppercase tracking-widest mb-1"><i class="fab fa-google mr-1 text-purple-400"></i> 구글 호스팅</p>
                    <h3 class="text-lg sm:text-2xl font-black text-purple-400" id="sales-google-revenue">0원</h3>
                </div>
                <div class="glass-panel p-4 sm:p-6 rounded-2xl relative overflow-hidden">
                    <p class="text-[9px] font-bold text-gray-400 uppercase tracking-widest mb-1"><i class="fas fa-server mr-1 text-purple-400"></i> 일반 호스팅</p>
                    <h3 class="text-lg sm:text-2xl font-black text-blue-400" id="sales-normal-revenue">0원</h3>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="glass-panel p-5 rounded-2xl">
                    <h3 class="text-xs font-bold text-white uppercase tracking-widest mb-4 border-b border-white/5 pb-2">월별 매출 현황</h3>
                    <div class="space-y-1 max-h-48 overflow-y-auto pr-2 custom-scrollbar" id="sales-monthly-list"></div>
                </div>
                <div class="glass-panel p-5 rounded-2xl">
                    <h3 class="text-xs font-bold text-white uppercase tracking-widest mb-4 border-b border-white/5 pb-2">년별 매출 현황</h3>
                    <div class="space-y-1 max-h-48 overflow-y-auto pr-2 custom-scrollbar" id="sales-yearly-list"></div>
                </div>
            </div>

            <div class="glass-panel rounded-2xl overflow-hidden">
                <div class="flex justify-between items-center p-4 sm:p-6 border-b border-white/5">
                    <h3 class="text-xs sm:text-sm font-bold text-white uppercase">상세 매출 내역</h3>
                    <div class="flex items-center gap-2">
                        <button onclick="togglePrivacy()" class="bg-white/5 text-gray-300 p-2 rounded-lg text-xs border border-white/10" title="개인정보 숨기기"><i class="fas fa-eye" id="privacy-icon"></i></button>
                        <button onclick="openDepositModal('add', 'sales')" class="bg-purple-600 text-white px-4 py-2 rounded-lg text-[10px] font-bold"><i class="fas fa-plus mr-1"></i> 매출 등록</button>
                    </div>
                </div>
                <div class="overflow-x-auto hidden md:block">
                    <table class="w-full text-left">
                        <thead><tr><th class="table-head p-4">거래일</th><th class="table-head p-4">상품명</th><th class="table-head p-4">고객명</th><th class="table-head p-4">연락처</th><th class="table-head p-4 text-right">매출 금액</th><th class="table-head p-4 text-center">세금계산서</th><th class="table-head p-4 text-right">관리</th></tr></thead>
                        <tbody id="sales-table-body" class="text-sm text-gray-300"></tbody>
                    </table>
                </div>
                <div id="sales-mobile-list" class="grid grid-cols-1 gap-3 p-4 md:hidden"></div>
            </div>
        </div>

        <!-- 4. 포트폴리오 관리 -->
        <div id="section-portfolios" class="content-section hidden">
            <div class="flex items-center justify-between mb-6">
                <h2 class="section-title !mb-0"><i class="fas fa-briefcase"></i> 포트폴리오 관리</h2>
                <button onclick="openPortfolioModal('add')" class="bg-white/10 text-white px-4 py-2 rounded-xl text-xs font-bold border border-white/20 transition-all"><i class="fas fa-plus"></i> 포트폴리오 추가</button>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4" id="portfolio-manage-list"></div>
        </div>

        <!-- 5. 견적 문의 내역 -->
        <div id="section-quotes" class="content-section hidden">
            <h2 class="section-title"><i class="fas fa-file-invoice-dollar"></i> 견적 문의 내역</h2>
            <div class="glass-panel rounded-2xl overflow-hidden">
                <div class="overflow-x-auto hidden md:block">
                    <table class="w-full text-left">
                        <thead><tr><th class="table-head p-4">접수일</th><th class="table-head p-4">분류</th><th class="table-head p-4">고객명</th><th class="table-head p-4">연락처</th><th class="table-head p-4">내용</th><th class="table-head p-4 w-24 text-right">관리</th></tr></thead>
                        <tbody id="quote-table-body" class="text-sm text-gray-300"></tbody>
                    </table>
                </div>
                <div id="quote-mobile-list" class="grid grid-cols-1 gap-3 p-4 md:hidden"></div>
            </div>
        </div>

        <!-- 6. 결제 현황 -->
        <div id="section-deposits" class="content-section hidden">
            <div class="flex items-center justify-between mb-6">
                <h2 class="section-title !mb-0"><i class="fas fa-won-sign"></i> 결제/입금 현황</h2>
                <button onclick="openDepositModal('add')" class="bg-white/10 text-white px-4 py-2 rounded-xl text-xs font-bold border border-white/20 transition-all"><i class="fas fa-plus"></i> 수기 등록</button>
            </div>
            <div class="glass-panel rounded-2xl overflow-hidden hidden md:block">
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead><tr><th class="table-head p-4">신청일</th><th class="table-head p-4">상품</th><th class="table-head p-4">입금자</th><th class="table-head p-4">연락처</th><th class="table-head p-4">상태</th><th class="table-head p-4 w-24 text-right">관리</th></tr></thead>
                        <tbody id="deposit-table-body" class="text-sm text-gray-300"></tbody>
                    </table>
                </div>
            </div>
            <div id="deposit-mobile-list" class="grid grid-cols-1 gap-3 md:hidden mobile-card-wrapper"></div>
        </div>

        <!-- 7. 사이트 설정 -->
        <div id="section-site-config" class="content-section hidden">
            <h2 class="section-title"><i class="fas fa-sliders-h"></i> 사이트 설정 (CMS)</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="glass-panel p-6 rounded-2xl">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xs font-bold text-white uppercase tracking-widest">상단 네온 알림바</h3>
                        <input type="checkbox" id="conf-top-show" class="w-5 h-5 accent-purple-600">
                    </div>
                    <input type="text" id="conf-top-text" class="custom-input" placeholder="알림바 텍스트 입력">
                </div>
                <div class="glass-panel p-6 rounded-2xl">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xs font-bold text-white uppercase tracking-widest">하단 플로팅 배너</h3>
                        <input type="checkbox" id="conf-bottom-show" class="w-5 h-5 accent-purple-600">
                    </div>
                    <input type="text" id="conf-bottom-title" class="custom-input mb-3" placeholder="메인 타이틀">
                    <input type="text" id="conf-bottom-sub" class="custom-input" placeholder="서브 텍스트">
                </div>
                <div class="glass-panel p-6 rounded-2xl lg:col-span-2">
                    <h3 class="text-xs font-bold text-white uppercase tracking-widest mb-4">공지사항 (Notice Ticker)</h3>
                    <input type="text" id="conf-notice-text" class="custom-input" placeholder="공지사항 텍스트 입력">
                </div>
            </div>
            <button id="save-config-btn" class="w-full mt-6 bg-purple-600 text-white font-bold py-4 rounded-xl text-xs uppercase tracking-widest shadow-lg">전체 설정 저장</button>
        </div>

        <!-- Footer -->
        <footer class="mt-12 pt-8 border-t border-white/5 flex flex-col items-center justify-center gap-3 text-center pb-10">
            <div class="flex items-center gap-2 opacity-50">
                <i class="fas fa-magic text-sm text-purple-400"></i>
                <div class="text-lg font-black tracking-tighter gradient-text uppercase">HANRORO</div>
            </div>
            <p class="text-[9px] text-gray-600 uppercase tracking-widest">© 2015 HANRORO ADMIN SYSTEM. ALL RIGHTS RESERVED.</p>
        </footer>
    </main>

    <!-- ADMIN MODALS -->
    <!-- 포트폴리오 모달 -->
    <div id="modal-portfolio" class="admin-modal" onclick="if(event.target === this) closeAdminModal('modal-portfolio')">
        <div class="admin-modal-content !max-w-[800px]">
            <h3 class="text-lg font-bold mb-6 flex justify-between items-center">
                <span id="pf-modal-title"><i class="fas fa-briefcase text-purple-500 mr-2"></i>포트폴리오 설정</span>
                <button onclick="closeAdminModal('modal-portfolio')"><i class="fas fa-times text-gray-400"></i></button>
            </h3>
            <form id="portfolio-modal-form" class="space-y-5">
                <input type="hidden" id="pf-id">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div><label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">프로젝트 제목</label><input type="text" id="pf-title-input" class="custom-input" required></div>
                    <div><label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">카테고리</label><input type="text" id="pf-category-input" class="custom-input" required></div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div><label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">클라이언트</label><input type="text" id="pf-client-input" class="custom-input" required></div>
                    <div><label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">제작 연도</label><input type="text" id="pf-year-input" class="custom-input" required></div>
                    <div>
                        <label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">배경 테마</label>
                        <select id="pf-color-input" class="custom-input bg-[#1a1625]">
                            <option value="from-blue-900/40 to-black">Blue</option>
                            <option value="from-purple-900/40 to-black">Purple</option>
                            <option value="from-indigo-900/40 to-black">Indigo</option>
                            <option value="from-pink-900/40 to-black">Pink</option>
                            <option value="from-green-900/40 to-black">Green</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">이미지 업로드 (500KB)</label>
                    <input type="file" id="pf-image-file" class="custom-input text-gray-400 file:bg-purple-600 file:text-white file:border-0 file:rounded-full file:px-3 file:py-1 file:text-[10px] file:mr-2" accept="image/*">
                    <input type="hidden" id="pf-image-base64">
                    <div id="pf-image-preview" class="mt-2 w-full h-32 bg-white/5 rounded-xl border border-dashed border-white/10 flex items-center justify-center overflow-hidden"><span class="text-gray-500 text-xs">Preview</span></div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div><label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">짧은 요약 (카드용)</label><textarea id="pf-desc-input" class="custom-input h-20 resize-none" required></textarea></div>
                    <div><label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">상세 설명 (본문용)</label><textarea id="pf-long-desc-input" class="custom-input h-20 resize-none" required></textarea></div>
                </div>
                <div><label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">주요 특징 (콤마 구분)</label><input type="text" id="pf-features-input" class="custom-input" placeholder="특징 1, 특징 2"></div>
                <div><label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">태그 (콤마 구분)</label><input type="text" id="pf-tags-input" class="custom-input" placeholder="Tag1, Tag2"></div>
                <div><label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">외부 링크 (URL)</label><input type="url" id="pf-link-input" class="custom-input"></div>
                <button type="submit" class="w-full bg-purple-600 text-white font-bold py-3.5 rounded-xl text-xs uppercase tracking-widest">저장하기</button>
            </form>
        </div>
    </div>

    <!-- 견적 모달 -->
    <div id="modal-quote" class="admin-modal" onclick="if(event.target === this) closeAdminModal('modal-quote')">
        <div class="admin-modal-content !p-0 overflow-hidden">
            <div class="p-6 bg-purple-900/40 border-b border-white/5 flex justify-between">
                <h3 class="text-xl font-black text-white" id="mq-title">견적 상세</h3>
                <button onclick="closeAdminModal('modal-quote')"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-6">
                <form id="quote-modal-form" class="space-y-4">
                    <input type="hidden" id="mq-id">
                    <div class="grid grid-cols-2 gap-4">
                        <label class="p-3 bg-white/5 border border-white/10 rounded-xl cursor-pointer flex items-center gap-2"><input type="radio" name="mq-category" value="일반" checked> <span class="text-xs">일반</span></label>
                        <label class="p-3 bg-white/5 border border-white/10 rounded-xl cursor-pointer flex items-center gap-2"><input type="radio" name="mq-category" value="기업"> <span class="text-xs">기업</span></label>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <input type="text" id="mq-name" class="custom-input" placeholder="고객명" required>
                        <input type="text" id="mq-contact" class="custom-input" placeholder="연락처" required>
                    </div>
                    <textarea id="mq-content" class="custom-input h-48 resize-none" placeholder="문의 내용"></textarea>
                    <button type="submit" class="w-full bg-purple-600 text-white py-3.5 rounded-xl text-xs font-bold uppercase">상담 내역 저장</button>
                </form>
            </div>
        </div>
    </div>

    <!-- 입금/매출 모달 -->
    <div id="modal-deposit" class="admin-modal" onclick="if(event.target === this) closeAdminModal('modal-deposit')">
        <div class="admin-modal-content">
            <h3 class="text-lg font-bold mb-6 flex justify-between">
                <span id="md-title">매출 데이터 등록</span>
                <button onclick="closeAdminModal('modal-deposit')"><i class="fas fa-times text-gray-400"></i></button>
            </h3>
            <form id="deposit-modal-form" class="space-y-4">
                <input type="hidden" id="md-id">
                <div><label class="text-[10px] text-gray-500 font-bold block mb-1">날짜</label><input type="date" id="md-date" class="custom-input" required></div>
                <div><label class="text-[10px] text-gray-500 font-bold block mb-1">상품</label><input type="text" id="md-type" class="custom-input" required></div>
                <div><label class="text-[10px] text-gray-500 font-bold block mb-1">금액</label><input type="number" id="md-price" class="custom-input" placeholder="숫자만 입력"></div>
                <div><label class="text-[10px] text-gray-500 font-bold block mb-1">성함</label><input type="text" id="md-name" class="custom-input" required></div>
                <div><label class="text-[10px] text-gray-500 font-bold block mb-1">연락처</label><input type="text" id="md-phone" class="custom-input" required></div>
                <div class="grid grid-cols-2 gap-3">
                    <select id="md-status" class="custom-input bg-[#1a1625]"><option value="pending">입금대기</option><option value="complete">입금완료</option></select>
                    <select id="md-tax-invoice" class="custom-input bg-[#1a1625]"><option value="pending">발행전</option><option value="complete">발행완료</option></select>
                </div>
                <button type="submit" class="w-full bg-purple-600 text-white py-3.5 rounded-xl text-xs font-bold uppercase">기록 저장</button>
            </form>
        </div>
    </div>

    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, collection, onSnapshot, addDoc, updateDoc, deleteDoc, doc, serverTimestamp, setDoc, orderBy, query, getDoc } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
        
        const firebaseConfig = { 
            apiKey: "AIzaSyBkWgHnnHTKaOfHmgt7P-OwptraKcwEXvI", authDomain: "hanroro-web.firebaseapp.app", projectId: "hanroro-web", appId: "1:461514865624:web:4ab6ad23c2e771b426d0ad" 
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const currentAppId = "hanroro-official-service";

        // Login UI Controller
        const checkAuthOverlay = () => {
            const isAuth = sessionStorage.getItem('admin_authenticated') === 'true';
            const overlay = document.getElementById('login-overlay');
            if(isAuth && overlay) {
                overlay.classList.add('hidden');
                document.body.classList.remove('overflow-hidden');
            }
        };

        // Initialize App
        const init = async () => {
            // Rule 3: Auth first
            try {
                await signInAnonymously(auth);
                checkAuthOverlay();
            } catch (err) {
                console.error("Auth initialization failed", err);
            }

            onAuthStateChanged(auth, (user) => {
                if (user) {
                    initDashboard();
                }
            });
        };

        // Form Submission
        document.getElementById('login-form').onsubmit = (e) => {
            e.preventDefault();
            const CORRECT_PASSCODE = "gksfhfh00@@";
            const val = document.getElementById('passcode-input').value;
            if(val === CORRECT_PASSCODE) {
                sessionStorage.setItem('admin_authenticated', 'true');
                checkAuthOverlay(); // 새로고침 없이 즉시 실행
            } else {
                document.getElementById('login-error').classList.remove('hidden');
                document.querySelector('.glass-panel').classList.add('shake');
                setTimeout(() => document.querySelector('.glass-panel').classList.remove('shake'), 500);
            }
        };

        window.logout = () => { 
            if(confirm('로그아웃 하시겠습니까?')) { 
                sessionStorage.removeItem('admin_authenticated'); 
                location.reload(); 
            }
        };

        function initDashboard() {
            const today = new Date();
            const dateStr = today.toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric' });
            if(document.getElementById('sales-today-date')) document.getElementById('sales-today-date').innerText = dateStr;

            const user = auth.currentUser;
            if (!user) return;

            // Projects
            onSnapshot(collection(db, 'artifacts', currentAppId, 'public', 'data', 'projects'), (snap) => {
                const listEl = document.getElementById('project-manage-list');
                let html = '';
                snap.forEach(d => {
                    const p = d.data();
                    const safeData = JSON.stringify({id: d.id, ...p}).replace(/"/g, '&quot;');
                    html += `
                    <div class="glass-panel p-4 rounded-xl flex items-center justify-between gap-4">
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2 mb-1"><span class="text-[9px] font-bold px-1.5 py-0.5 rounded bg-purple-500/20 text-purple-300 border border-purple-500/10 uppercase">${p.phase}</span><h4 class="font-bold text-white text-xs truncate">${p.name}</h4></div>
                            <div class="w-full bg-gray-700 h-1 rounded-full mt-1.5 overflow-hidden"><div class="bg-purple-500 h-full" style="width: ${p.progress}%"></div></div>
                        </div>
                        <div class="flex gap-1.5">
                            <button class="bg-white/5 text-gray-400 p-2 rounded-lg text-[10px]" onclick="window.editProject(${safeData})"><i class="fas fa-edit"></i></button>
                            <button class="bg-red-500/10 text-red-400 p-2 rounded-lg text-[10px]" onclick="window.deleteProject('${d.id}')"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>`;
                });
                if(listEl) listEl.innerHTML = html || '<div class="text-center text-gray-500 py-4 text-xs">내역 없음</div>';
                if(document.getElementById('stat-active-projects')) document.getElementById('stat-active-projects').innerText = snap.size;
            }, (err) => console.error(err));

            // Portfolios
            onSnapshot(collection(db, 'artifacts', currentAppId, 'public', 'data', 'portfolios'), (snap) => {
                const listEl = document.getElementById('portfolio-manage-list');
                let html = '';
                snap.forEach(d => {
                    const pf = d.data();
                    const safeData = JSON.stringify({id: d.id, ...pf}).replace(/"/g, '&quot;');
                    html += `
                    <div class="glass-panel p-3 rounded-xl flex flex-col gap-3 group">
                        <div class="w-full aspect-video rounded-lg bg-cover bg-center border border-white/10 relative overflow-hidden" style="background-image: url('${pf.imageUrl}')">
                            <div class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2">
                                <button onclick="window.openPortfolioModal('edit', null, ${safeData})" class="bg-white text-black w-7 h-7 rounded-full flex items-center justify-center"><i class="fas fa-edit text-[10px]"></i></button>
                                <button onclick="window.deletePortfolio('${d.id}')" class="bg-red-500 text-white w-7 h-7 rounded-full flex items-center justify-center"><i class="fas fa-trash text-[10px]"></i></button>
                            </div>
                        </div>
                        <div class="min-w-0">
                            <div class="text-[9px] text-purple-400 font-bold uppercase mb-1">${pf.category}</div>
                            <h4 class="font-bold text-white text-xs truncate">${pf.title}</h4>
                            <p class="text-[9px] text-gray-500 truncate">${pf.client} | ${pf.year}</p>
                        </div>
                    </div>`;
                });
                if(listEl) listEl.innerHTML = html || '<div class="col-span-full text-center text-gray-500 py-10 text-xs">내역 없음</div>';
            }, (err) => console.error(err));

            // Quotes
            onSnapshot(collection(db, 'artifacts', currentAppId, 'public', 'data', 'quotes'), (snap) => {
                const tbody = document.getElementById('quote-table-body');
                const mobileList = document.getElementById('quote-mobile-list');
                let html = ''; let mobileHtml = '';
                snap.forEach(d => {
                    const q = d.data();
                    const safeData = JSON.stringify({id: d.id, ...q}).replace(/"/g, '&quot;');
                    const date = q.createdAt ? new Date(q.createdAt.seconds * 1000).toLocaleDateString() : '-';
                    html += `<tr class="table-row"><td class="p-4 text-gray-500 font-mono text-[10px]">${date}</td><td class="p-4"><span class="px-2 py-0.5 rounded bg-white/5 border border-white/10 text-[9px] font-bold">${q.category || '일반'}</span></td><td class="p-4 font-bold text-white text-xs">${q.name}</td><td class="p-4 text-gray-400 text-xs">${q.contact}</td><td class="p-4 text-gray-500 truncate max-w-[150px] text-xs cursor-pointer" onclick="window.openQuoteModal('edit', null, ${safeData})">${q.content}</td><td class="p-4 text-right"><div class="flex justify-end gap-2"><button class="text-gray-500 hover:text-white" onclick="window.openQuoteModal('edit', null, ${safeData})"><i class="fas fa-edit"></i></button><button class="text-gray-500 hover:text-red-400" onclick="window.deleteQuote('${d.id}')"><i class="fas fa-trash"></i></button></div></td></tr>`;
                    mobileHtml += `<div class="unified-card"><div class="flex justify-between items-center mb-3"><span class="px-2 py-0.5 rounded bg-white/5 border border-white/5 text-[9px] font-bold text-gray-400">${q.category || '일반'}</span><span class="text-[9px] font-mono text-gray-600">${date}</span></div><h4 class="font-bold text-white text-sm mb-1">${q.name}</h4><div class="text-[10px] text-gray-500 mb-2">${q.contact}</div><div class="p-3 bg-white/5 rounded-lg text-[10px] text-gray-400 mb-4 line-clamp-2">${q.content}</div><div class="flex gap-2"><button onclick="window.openQuoteModal('edit', null, ${safeData})" class="flex-1 bg-white/5 py-2 rounded text-[10px] text-gray-300 font-bold">상세</button><button onclick="window.deleteQuote('${d.id}')" class="flex-1 bg-red-500/10 py-2 rounded text-[10px] text-red-400 font-bold">삭제</button></div></div>`;
                });
                if(tbody) tbody.innerHTML = html; 
                if(mobileList) mobileList.innerHTML = mobileHtml || '<div class="text-center text-gray-600 py-10 text-xs">내역 없음</div>';
                if(document.getElementById('stat-new-quotes')) document.getElementById('stat-new-quotes').innerText = snap.size;
            }, (err) => console.error(err));

            // Deposits & Sales
            let latestDepositSnap = null;
            let isPrivacyMode = false;
            window.togglePrivacy = () => { isPrivacyMode = !isPrivacyMode; const icon = document.getElementById('privacy-icon'); if (isPrivacyMode) { icon.classList.replace('fa-eye', 'fa-eye-slash'); icon.parentElement.classList.add('text-purple-400'); } else { icon.classList.replace('fa-eye-slash', 'fa-eye'); icon.parentElement.classList.remove('text-purple-400'); } renderDepositData(); };

            const renderDepositData = () => {
                if (!latestDepositSnap) return;
                const tbody = document.getElementById('deposit-table-body');
                const mobileList = document.getElementById('deposit-mobile-list');
                const salesBody = document.getElementById('sales-table-body');
                const salesMobileList = document.getElementById('sales-mobile-list');
                let tableHtml = ''; let mobileHtml = ''; let salesHtml = ''; let salesMobileHtml = '';
                let pendingCount = 0; let totalRevenue = 0; let totalVat = 0; let googleRevenue = 0; let normalRevenue = 0;
                const monthlyStats = {}; const yearlyStats = {};

                latestDepositSnap.forEach(d => {
                    const dep = d.data();
                    const isComplete = dep.status === 'complete' || dep.status === '입금완료';
                    const taxStatus = dep.taxInvoice === 'complete' ? '완료' : '대기';
                    const taxClass = dep.taxInvoice === 'complete' ? 'tax-complete' : 'tax-pending';
                    let displayDateStr; let statYear, statMonth;
                    if (dep.date) { displayDateStr = dep.date; const [y, m] = dep.date.split('-'); statYear = parseInt(y); statMonth = m; }
                    else { const dateObj = dep.createdAt ? new Date(dep.createdAt.seconds * 1000) : new Date(); displayDateStr = `${dateObj.getFullYear()}-${String(dateObj.getMonth()+1).padStart(2,'0')}-${String(dateObj.getDate()).padStart(2,'0')}`; statYear = dateObj.getFullYear(); statMonth = String(dateObj.getMonth()+1).padStart(2,'0'); }
                    const safeData = JSON.stringify({id: d.id, ...dep}).replace(/"/g, '&quot;');
                    if(!isComplete) pendingCount++;

                    if (isComplete) {
                        let price = dep.price ? Number(dep.price) : (dep.type.includes('구글') ? 1430000 : (dep.type.includes('일반') ? 1530000 : 0));
                        if (dep.type.includes('구글')) googleRevenue += price; else if (dep.type.includes('일반')) normalRevenue += price;
                        totalRevenue += price; totalVat += Math.round(price - (price / 1.1));
                        const yearKey = `${statYear}년`; const monthKey = `${statYear}-${statMonth}`;
                        if (!yearlyStats[yearKey]) yearlyStats[yearKey] = 0; yearlyStats[yearKey] += price;
                        if (!monthlyStats[monthKey]) monthlyStats[monthKey] = { label: `${statYear}년 ${statMonth}월`, amount: 0 }; monthlyStats[monthKey].amount += price;
                        let displayName = isPrivacyMode ? (dep.name.charAt(0) + '***') : dep.name;
                        let displayPhone = isPrivacyMode ? (dep.phone.charAt(0) + '***') : dep.phone;

                        salesHtml += `<tr class="table-row"><td class="p-4 text-gray-500 font-mono text-[10px]">${displayDateStr}</td><td class="p-4"><span class="px-2 py-0.5 rounded bg-purple-500/10 text-purple-300 border border-purple-500/10 text-[9px] font-bold">${dep.type}</span></td><td class="p-4 font-bold text-white text-xs">${displayName}</td><td class="p-4 text-gray-400 text-[10px] font-mono">${displayPhone}</td><td class="p-4 text-right font-mono font-bold text-white text-xs">${price.toLocaleString()}원</td><td class="p-4 text-center"><span class="status-badge ${taxClass}">${taxStatus}</span></td><td class="p-4 text-right"><div class="flex justify-end gap-2"><button class="text-gray-500 hover:text-white" onclick="window.openDepositModal('edit', null, ${safeData})"><i class="fas fa-edit"></i></button><button class="text-gray-500 hover:text-red-400" onclick="window.deleteDeposit('${d.id}')"><i class="fas fa-trash"></i></button></div></td></tr>`;
                        salesMobileHtml += `<div class="unified-card"><div class="flex justify-between items-center mb-3"><span class="px-2 py-0.5 rounded bg-purple-500/10 text-purple-300 text-[9px] font-bold">${dep.type}</span><span class="status-badge ${taxClass}">VAT ${taxStatus}</span></div><div class="flex justify-between items-end mb-2"><h4 class="font-bold text-white text-sm">${displayName}</h4><span class="font-bold text-white font-mono text-xs">${price.toLocaleString()}원</span></div><div class="text-[9px] text-gray-500 flex justify-between"><span>${displayPhone}</span><span class="font-mono">${displayDateStr}</span></div></div>`;
                    }
                    tableHtml += `<tr class="table-row"><td class="p-4 text-gray-500 font-mono text-[10px]">${displayDateStr}</td><td class="p-4 text-[10px] text-purple-300 font-bold">${dep.type}</td><td class="p-4 font-bold text-white text-xs">${dep.name}</td><td class="p-4 text-gray-400 text-xs">${dep.phone}</td><td class="p-4"><span class="status-badge ${isComplete ? 'status-complete' : 'status-pending'}">${isComplete ? '완료' : '대기'}</span></td><td class="p-4 text-right"><div class="flex justify-end gap-2">${!isComplete ? `<button class="text-green-400" onclick="window.markAsComplete('${d.id}')"><i class="fas fa-check-circle"></i></button>` : ''}<button class="text-gray-500" onclick="window.openDepositModal('edit', null, ${safeData})"><i class="fas fa-edit"></i></button></div></td></tr>`;
                    mobileHtml += `<div class="unified-card"><div class="flex justify-between mb-4"><span class="text-[9px] font-black text-purple-300">${dep.type}</span><span class="text-[8px] font-black px-1.5 py-0.5 rounded border ${isComplete ? 'text-purple-400 border-purple-400/30' : 'text-yellow-500 border-yellow-500/30'}">${isComplete ? '완료' : '대기'}</span></div><div class="flex justify-between items-end mb-3"><div><h4 class="font-bold text-white text-xs">${dep.name}</h4><p class="text-[9px] text-gray-500">${dep.phone}</p></div><div class="text-[9px] text-gray-600 font-mono">${displayDateStr}</div></div><div class="flex gap-2 pt-3 border-t border-white/5">${!isComplete ? `<button onclick="window.markAsComplete('${d.id}')" class="flex-1 bg-green-500/10 py-2 rounded text-[10px] text-green-400 font-bold">입금확인</button>` : ''}<button onclick="window.openDepositModal('edit', null, ${safeData})" class="flex-1 bg-white/5 py-2 rounded text-[10px] text-gray-300 font-bold">수정</button><button onclick="window.deleteDeposit('${d.id}')" class="flex-1 bg-red-500/10 py-2 rounded text-[10px] text-red-400 font-bold">삭제</button></div></div>`;
                });

                if(tbody) tbody.innerHTML = tableHtml; 
                if(mobileList) mobileList.innerHTML = mobileHtml;
                if(document.getElementById('stat-pending-deposits')) document.getElementById('stat-pending-deposits').innerText = pendingCount;
                if(document.getElementById('sales-total-revenue')) document.getElementById('sales-total-revenue').innerText = totalRevenue.toLocaleString() + '원';
                if(document.getElementById('sales-vat-revenue')) document.getElementById('sales-vat-revenue').innerText = totalVat.toLocaleString() + '원';
                if(document.getElementById('sales-net-revenue')) document.getElementById('sales-net-revenue').innerText = (totalRevenue - totalVat).toLocaleString() + '원';
                if(document.getElementById('sales-google-revenue')) document.getElementById('sales-google-revenue').innerText = googleRevenue.toLocaleString() + '원';
                if(document.getElementById('sales-normal-revenue')) document.getElementById('sales-normal-revenue').innerText = normalRevenue.toLocaleString() + '원';
                if(salesBody) salesBody.innerHTML = salesHtml; 
                if(salesMobileList) salesMobileList.innerHTML = salesMobileHtml;

                const monthlyKeys = Object.keys(monthlyStats).sort().reverse();
                let monthlyHtml = ''; monthlyKeys.forEach(k => { monthlyHtml += `<div class="flex justify-between p-2 rounded bg-white/5 mb-1"><span class="text-[10px] text-gray-400">${monthlyStats[k].label}</span><span class="text-[10px] font-bold text-white">${monthlyStats[k].amount.toLocaleString()}원</span></div>`; });
                if(document.getElementById('sales-monthly-list')) document.getElementById('sales-monthly-list').innerHTML = monthlyHtml;

                const yearlyKeys = Object.keys(yearlyStats).sort().reverse();
                let yearlyHtml = ''; yearlyKeys.forEach(k => { yearlyHtml += `<div class="flex justify-between p-2 rounded bg-white/5 mb-1"><span class="text-[10px] text-gray-400">${k}</span><span class="text-[10px] font-bold text-purple-400">${yearlyStats[k].toLocaleString()}원</span></div>`; });
                if(document.getElementById('sales-yearly-list')) document.getElementById('sales-yearly-list').innerHTML = yearlyHtml;
            };

            onSnapshot(collection(db, 'artifacts', currentAppId, 'public', 'data', 'deposits'), (snap) => { latestDepositSnap = snap; renderDepositData(); }, (err) => console.error(err));

            // Config
            getDoc(doc(db, 'artifacts', currentAppId, 'public', 'data', 'configs', 'mainSettings')).then((s) => {
                if(s.exists()) {
                    const d = s.data(); 
                    if(document.getElementById('conf-notice-text')) document.getElementById('conf-notice-text').value = d.noticeTitle || '';
                    if(document.getElementById('conf-top-show')) document.getElementById('conf-top-show').checked = d.showTopBar !== false; 
                    if(document.getElementById('conf-top-text')) document.getElementById('conf-top-text').value = d.topBarText || '';
                    if(document.getElementById('conf-bottom-show')) document.getElementById('conf-bottom-show').checked = d.showBottomBar !== false; 
                    if(document.getElementById('conf-bottom-title')) document.getElementById('conf-bottom-title').value = d.bottomBarTitle || ''; 
                    if(document.getElementById('conf-bottom-sub')) document.getElementById('conf-bottom-sub').value = d.bottomBarSub || '';
                }
            });

            document.getElementById('save-config-btn').onclick = async () => {
                try {
                    await setDoc(doc(db, 'artifacts', currentAppId, 'public', 'data', 'configs', 'mainSettings'), { noticeTitle: document.getElementById('conf-notice-text').value, showTopBar: document.getElementById('conf-top-show').checked, topBarText: document.getElementById('conf-top-text').value, showBottomBar: document.getElementById('conf-bottom-show').checked, bottomBarTitle: document.getElementById('conf-bottom-title').value, bottomBarSub: document.getElementById('conf-bottom-sub').value, updatedAt: serverTimestamp() }, { merge: true });
                    alert('저장 완료');
                } catch(e) { alert('실패'); }
            };
        }

        // Methods
        window.editProject = (d) => {
            document.getElementById('p-id').value = d.id; document.getElementById('p-name').value = d.name; document.getElementById('p-phase').value = d.phase; document.getElementById('p-progress').value = d.progress; document.getElementById('p-prog-val').innerText = d.progress + "%";
            document.getElementById('p-form-title').innerText = "프로젝트 수정"; document.getElementById('p-submit-btn').innerText = "변경사항 저장"; document.getElementById('p-form-reset').classList.remove('hidden');
        };
        window.resetProjectForm = () => { document.getElementById('project-form').reset(); document.getElementById('p-id').value = ""; document.getElementById('p-form-title').innerText = "새 프로젝트 등록"; document.getElementById('p-form-reset').classList.add('hidden'); };
        document.getElementById('project-form').onsubmit = async (e) => {
            e.preventDefault(); const d = { name: document.getElementById('p-name').value, phase: document.getElementById('p-phase').value, progress: parseInt(document.getElementById('p-progress').value) };
            const id = document.getElementById('p-id').value;
            try { if(id) await updateDoc(doc(db, 'artifacts', currentAppId, 'public', 'data', 'projects', id), d); else { d.createdAt = serverTimestamp(); await addDoc(collection(db, 'artifacts', currentAppId, 'public', 'data', 'projects'), d); } resetProjectForm(); } catch(e) { alert('오류'); }
        };
        window.deleteProject = async (id) => { if(confirm('삭제?')) await deleteDoc(doc(db, 'artifacts', currentAppId, 'public', 'data', 'projects', id)); };

        let currentPfBase64 = "";
        let editingPortfolioId = null;
        window.openPortfolioModal = (mode, _, data = null) => {
            const previewEl = document.getElementById('pf-image-preview');
            if(mode==='edit'&&data) {
                editingPortfolioId=data.id; document.getElementById('pf-id').value=data.id; document.getElementById('pf-title-input').value=data.title;
                document.getElementById('pf-category-input').value=data.category; document.getElementById('pf-client-input').value=data.client; document.getElementById('pf-year-input').value=data.year;
                document.getElementById('pf-color-input').value=data.imageColor||"from-blue-900/40 to-black"; document.getElementById('pf-desc-input').value=data.desc||'';
                document.getElementById('pf-long-desc-input').value=data.longDesc||''; document.getElementById('pf-features-input').value=data.features?data.features.join(', '):'';
                document.getElementById('pf-tags-input').value=data.tags?data.tags.join(', '):''; document.getElementById('pf-link-input').value=data.linkUrl||'';
                currentPfBase64=data.imageUrl||""; previewEl.innerHTML=currentPfBase64?`<img src="${currentPfBase64}" class="w-full h-full object-cover">`:'';
            } else { editingPortfolioId=null; document.getElementById('portfolio-modal-form').reset(); document.getElementById('pf-id').value=""; currentPfBase64=""; previewEl.innerHTML=""; }
            document.getElementById('modal-portfolio').classList.add('active');
        };
        document.getElementById('pf-image-file').onchange = (e) => {
            const f = e.target.files[0]; if(!f) return; if(f.size>512000) { alert('500KB 초과'); e.target.value=''; return; }
            const r = new FileReader(); r.onload=(ev)=>{ currentPfBase64=ev.target.result; document.getElementById('pf-image-preview').innerHTML=`<img src="${currentPfBase64}" class="w-full h-full object-cover">`; }; r.readAsDataURL(f);
        };
        document.getElementById('portfolio-modal-form').onsubmit = async (e) => {
            e.preventDefault(); if(!currentPfBase64) { alert('이미지 필요'); return; }
            const d = { title:document.getElementById('pf-title-input').value, category:document.getElementById('pf-category-input').value, client:document.getElementById('pf-client-input').value, year:document.getElementById('pf-year-input').value, imageColor:document.getElementById('pf-color-input').value, imageUrl:currentPfBase64, desc:document.getElementById('pf-desc-input').value, longDesc:document.getElementById('pf-long-desc-input').value, features:document.getElementById('pf-features-input').value.split(',').map(s=>s.trim()).filter(s=>s), tags:document.getElementById('pf-tags-input').value.split(',').map(s=>s.trim()).filter(s=>s), linkUrl:document.getElementById('pf-link-input').value };
            try { if(editingPortfolioId) await updateDoc(doc(db,'artifacts',currentAppId,'public','data','portfolios',editingPortfolioId),d); else { d.createdAt=serverTimestamp(); await addDoc(collection(db,'artifacts',currentAppId,'public','data','portfolios'),d); } closeAdminModal('modal-portfolio'); } catch(e) { alert('실패'); }
        };
        window.deletePortfolio = async (id) => { if(confirm('삭제?')) await deleteDoc(doc(db, 'artifacts', currentAppId, 'public', 'data', 'portfolios', id)); };

        let editingQuoteId = null;
        window.openQuoteModal = (m, _, d=null) => {
            if(m==='edit'&&d) { editingQuoteId=d.id; document.getElementById('mq-id').value=d.id; document.getElementById('mq-name').value=d.name; document.getElementById('mq-contact').value=d.contact; document.getElementById('mq-content').value=d.content; }
            else { editingQuoteId=null; document.getElementById('quote-modal-form').reset(); }
            document.getElementById('modal-quote').classList.add('active');
        };
        document.getElementById('quote-modal-form').onsubmit = async (e) => {
            e.preventDefault(); const cat = document.querySelector('input[name="mq-category"]:checked').value;
            try { if(editingQuoteId) await updateDoc(doc(db,'artifacts',currentAppId,'public','data','quotes',editingQuoteId),{category:cat,name:document.getElementById('mq-name').value,contact:document.getElementById('mq-contact').value,content:document.getElementById('mq-content').value}); closeAdminModal('modal-quote'); } catch(e) { alert('실패'); }
        };
        window.deleteQuote = async (id) => { if(confirm('삭제?')) await deleteDoc(doc(db, 'artifacts', currentAppId, 'public', 'data', 'quotes', id)); };

        let editingDepositId = null;
        window.openDepositModal = (m, s=null, d=null) => {
            const today = new Date().toISOString().split('T')[0];
            if(m==='edit'&&d) { editingDepositId=d.id; document.getElementById('md-id').value=d.id; document.getElementById('md-type').value=d.type; document.getElementById('md-name').value=d.name; document.getElementById('md-phone').value=d.phone; document.getElementById('md-price').value=d.price||""; document.getElementById('md-status').value=d.status==='complete'?'complete':'pending'; document.getElementById('md-date').value=d.date||today; }
            else { editingDepositId=null; document.getElementById('deposit-modal-form').reset(); document.getElementById('md-date').value=today; if(s==='sales') document.getElementById('md-status').value='complete'; }
            document.getElementById('modal-deposit').classList.add('active');
        };
        window.markAsComplete = async (id) => { if(confirm('완료처리?')) await updateDoc(doc(db, 'artifacts', currentAppId, 'public', 'data', 'deposits', id), { status: 'complete' }); };
        document.getElementById('deposit-modal-form').onsubmit = async (e) => {
            e.preventDefault(); const d = { type:document.getElementById('md-type').value, name:document.getElementById('md-name').value, phone:document.getElementById('md-phone').value, status:document.getElementById('md-status').value, taxInvoice:document.getElementById('md-tax-invoice').value, date:document.getElementById('md-date').value };
            if(document.getElementById('md-price').value) d.price=Number(document.getElementById('md-price').value);
            try { if(editingDepositId) await updateDoc(doc(db,'artifacts',currentAppId,'public','data','deposits',editingDepositId),d); else { d.createdAt=serverTimestamp(); await addDoc(collection(db,'artifacts',currentAppId,'public','data','deposits'),d); } closeAdminModal('modal-deposit'); } catch(e) { alert('실패'); }
        };
        window.deleteDeposit = async (id) => { if(confirm('삭제?')) await deleteDoc(doc(db, 'artifacts', currentAppId, 'public', 'data', 'deposits', id)); };

        // Utils
        window.closeAdminModal = (id) => { document.getElementById(id).classList.remove('active'); };
        window.toggleMobileMenu = (show) => { document.getElementById('mobile-drawer').classList.toggle('active', show); document.getElementById('mobile-overlay').classList.toggle('active', show); };
        window.showSection = (id, el) => {
            document.querySelectorAll('.content-section').forEach(s => s.classList.add('hidden')); 
            const target = document.getElementById('section-'+id);
            if(target) target.classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active')); 
            const dNav = document.querySelector(`#desktop-menu .nav-item[onclick*="'${id}'"]`); 
            if(dNav) dNav.classList.add('active');
            toggleMobileMenu(false); 
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        // Start App
        init();

        // Particle Class (Background)
        class Particle {
            constructor(w, h) { this.x = Math.random() * w; this.y = Math.random() * -h; this.speed = Math.random() * 2 + 1.5; this.width = Math.random() * 2 + 1; this.color = `hsla(${Math.random() * 60 + 250}, 80%, 65%, 0.8)`; }
            update(h) { this.y += this.speed; if (this.y > h) { this.y = Math.random() * -100; } }
            draw(ctx) { ctx.beginPath(); ctx.fillStyle = this.color; ctx.fillRect(this.x, this.y, this.width, 10); ctx.closePath(); }
        }

        const canvas = document.getElementById('magic-rain');
        if (canvas) {
            const ctx = canvas.getContext('2d');
            let w = canvas.width = window.innerWidth;
            let h = canvas.height = window.innerHeight;
            let ps = Array.from({length: Math.floor(w/15)}, () => new Particle(w, h));
            const animate = () => {
                ctx.fillStyle = 'rgba(5, 2, 10, 0.15)'; ctx.fillRect(0, 0, w, h);
                ps.forEach(p => { p.update(h); p.draw(ctx); });
                requestAnimationFrame(animate);
            };
            animate();
            window.onresize = () => { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; ps = Array.from({length: Math.floor(w/15)}, () => new Particle(w, h)); };
        }
    </script>
</body>
</html>
