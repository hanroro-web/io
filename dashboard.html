<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, viewport-fit=cover">
    <title>HANRORO 관리자 대시보드</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Spline Viewer 제거 (메모리 최적화) -->
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@100..900&display=swap');
        :root { --vibe-deep: #05020a; --vibe-primary: #8a4fff; }
        
        /* HTML/Body 스크롤 최적화 */
        html {
            scroll-behavior: smooth;
        }

        body { 
            font-family: 'Pretendard', sans-serif; 
            background-color: var(--vibe-deep); 
            color: #ffffff; 
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
        }

        /* 스크롤바 커스텀 */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #0f0a1f; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #8a4fff; }

        /* 글래스모피즘 네비게이션 */
        .glass-nav { 
            background: rgba(5, 2, 10, 0.85); 
            backdrop-filter: blur(12px); 
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }

        .nav-item {
            position: relative;
            color: #94a3b8;
            font-size: 0.9rem;
            font-weight: 600;
            padding: 8px 16px;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 99px;
        }
        .nav-item:hover, .nav-item.active {
            color: #fff;
            background: rgba(255, 255, 255, 0.1);
        }
        .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: -22px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 2px;
            background: #8a4fff;
            box-shadow: 0 0 10px #8a4fff;
        }

        /* 텍스트 그라데이션 및 스타일 */
        .gradient-text { background: linear-gradient(90deg, #a78bfa, #c084fc); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* 로고 애니메이션 */
        .magic-wand-float { animation: wandFloat 3s ease-in-out infinite; display: inline-block; }
        @keyframes wandFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-12px) rotate(12deg); }
        }

        /* Hero 3D Wand & Rain Effect (사파리 메모리 최적화 적용) */
        .magic-rain-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.8;
            pointer-events: none;
            /* mix-blend-mode: screen; -> 제거하여 성능 향상 가능 */
        }

        .hero-wand-container {
            perspective: 1000px;
            position: absolute;
            right: -5%;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1;
            opacity: 1;
            pointer-events: none;
        }
        
        .hero-wand-3d {
            font-size: clamp(15rem, 40vw, 35rem);
            background: linear-gradient(135deg, #ffffff 0%, #e9d5ff 20%, #a855f7 50%, #7e22ce 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            
            /* [최적화 핵심] filter 대신 text-shadow 사용 (사파리 튕김 방지) */
            text-shadow: 
                0 0 20px rgba(168, 85, 247, 0.5),
                0 0 40px rgba(168, 85, 247, 0.3);
            
            animation: heroWandFloat 6s ease-in-out infinite;
            transform-style: preserve-3d;
            transform: rotateZ(-15deg) rotateY(15deg);
            /* will-change 제거하여 메모리 절약 */
        }

        @keyframes heroWandFloat {
            0%, 100% { 
                transform: translateY(0) rotateZ(-15deg) rotateY(15deg) scale(1); 
                text-shadow: 0 0 20px rgba(168, 85, 247, 0.5), 0 0 40px rgba(168, 85, 247, 0.3);
            }
            50% { 
                transform: translateY(-30px) rotateZ(-12deg) rotateY(5deg) scale(1.02); 
                text-shadow: 0 0 30px rgba(192, 132, 252, 0.7), 0 0 60px rgba(168, 85, 247, 0.5);
            }
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            transition: transform 0.3s ease, border-color 0.3s ease;
        }
        .glass-panel:hover {
            border-color: rgba(138, 79, 255, 0.3);
        }

        /* --- 기존 대시보드 스타일 유지 --- */
        .custom-input { width: 100%; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 10px 14px; color: white; outline: none; transition: border-color 0.2s; font-size: 0.85rem; }
        .custom-input:focus { border-color: #8a4fff; }
        .status-badge { padding: 4px 8px; border-radius: 6px; font-size: 10px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.05em; }
        .status-pending { background: rgba(234, 179, 8, 0.1); color: #fbbf24; border: 1px solid rgba(234, 179, 8, 0.2); }
        .status-complete { background: rgba(138, 79, 255, 0.15); color: #c084fc; border: 1px solid rgba(138, 79, 255, 0.3); }
        .table-row { border-bottom: 1px solid rgba(255, 255, 255, 0.05); transition: background 0.2s; }
        .table-row:hover { background: rgba(255, 255, 255, 0.02); }
        .table-head { font-size: 11px; text-transform: uppercase; color: #64748b; font-weight: 700; letter-spacing: 0.05em; padding-bottom: 12px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        .section-title { font-size: 1.25rem; font-weight: 800; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 10px; letter-spacing: -0.02em; }
        .section-title i { color: #8a4fff; font-size: 1rem; }
        .toggle-checkbox:checked { right: 0; border-color: #8a4fff; }
        .toggle-checkbox:checked + .toggle-label { background-color: #8a4fff; }

        /* Modal Styles */
        .admin-modal { display: none; position: fixed; inset: 0; z-index: 9999; background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(8px); align-items: center; justify-content: center; padding: 20px; }
        .admin-modal.active { display: flex; }
        .admin-modal-content { background: #0f0a1f; border: 1px solid rgba(255, 255, 255, 0.1); width: 100%; max-width: 600px; border-radius: 20px; padding: 30px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); max-height: 90vh; overflow-y: auto; }

        /* Login Overlay */
        #login-overlay { position: fixed; inset: 0; background-color: #05020a; z-index: 10000; display: flex; align-items: center; justify-content: center; flex-direction: column; transition: opacity 0.5s ease; }
        #login-overlay.hidden { opacity: 0; pointer-events: none; }
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }

        /* Mobile Drawer */
        .mobile-drawer-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 60; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
        .mobile-drawer-overlay.active { opacity: 1; pointer-events: auto; }
        .mobile-drawer { position: fixed; top: 0; right: 0; bottom: 0; width: 280px; background: #0f0a1f; border-left: 1px solid rgba(255,255,255,0.1); z-index: 70; transform: translateX(100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: flex; flex-direction: column; padding: 24px; }
        .mobile-drawer.active { transform: translateX(0); }
        .drawer-item { padding: 16px; border-radius: 12px; font-weight: 600; color: #94a3b8; margin-bottom: 4px; transition: all 0.2s; display: flex; items-center; gap: 12px; }
        .drawer-item:hover, .drawer-item.active { background: rgba(138, 79, 255, 0.1); color: white; }
        .drawer-item.active i { color: #8a4fff; }

        @media (max-width: 1024px) {
            .nav-item.active::after { display: none; }
            .hero-wand-container { right: -15%; opacity: 0.7; }
            .hero-wand-3d { font-size: 24rem; }
        }
    </style>
</head>
<body class="min-h-screen overflow-hidden">

    <!-- LOGIN OVERLAY -->
    <div id="login-overlay">
        <div class="glass-panel p-8 rounded-2xl w-full max-w-sm text-center border-t border-purple-500/20">
            <div class="mb-6">
                <i class="fas fa-shield-alt text-4xl text-purple-500 mb-4"></i>
                <h2 class="text-2xl font-black tracking-tight text-white uppercase">Admin Access</h2>
                <p class="text-xs text-gray-500 mt-2">관리자 패스코드를 입력하세요.</p>
            </div>
            <form id="login-form" class="space-y-4">
                <input type="password" id="passcode-input" class="custom-input text-center tracking-widest text-lg py-3" placeholder="PASSCODE" autofocus required>
                <button type="submit" class="w-full bg-purple-600 hover:bg-purple-500 text-white font-bold py-3.5 rounded-xl transition-all shadow-lg shadow-purple-900/20 uppercase tracking-widest text-xs">
                    접속하기
                </button>
            </form>
            <p id="login-error" class="text-red-500 text-xs mt-4 font-bold hidden"><i class="fas fa-exclamation-circle mr-1"></i> 패스코드가 올바르지 않습니다.</p>
        </div>
        <div class="absolute bottom-10 text-gray-600 text-[10px] font-mono">SECURED BY HANRORO SYSTEM</div>
    </div>

    <!-- 상단 네비게이션 (Top Bar) -->
    <nav class="fixed w-full z-50 glass-nav h-16 sm:h-20 flex items-center justify-between px-6">
        <!-- 로고 영역 -->
        <div class="flex items-center gap-2 cursor-pointer" onclick="location.reload()">
            <i class="fas fa-magic text-lg text-purple-400 magic-wand-float"></i>
            <div class="text-xl font-black tracking-tighter gradient-text uppercase">HANRORO</div>
        </div>

        <!-- 데스크탑 메뉴 -->
        <div class="hidden lg:flex items-center gap-2" id="desktop-menu">
            <div class="nav-item active" onclick="showSection('dashboard', this)">대시보드</div>
            <div class="nav-item" onclick="showSection('projects', this)">프로젝트 관리</div>
            <div class="nav-item" onclick="showSection('portfolios', this)">포트폴리오</div>
            <div class="nav-item" onclick="showSection('quotes', this)">견적 문의</div>
            <div class="nav-item" onclick="showSection('deposits', this)">결제 현황</div>
            <div class="nav-item" onclick="showSection('site-config', this)">사이트 설정</div>
        </div>

        <div class="flex items-center gap-4">
            <!-- 데스크탑 관리자 프로필 -->
            <div class="hidden sm:flex items-center gap-3 px-3 py-1.5 rounded-full bg-white/5 border border-white/10 group relative">
                <div class="w-6 h-6 rounded-full bg-purple-600 flex items-center justify-center font-bold text-[10px]">A</div>
                <span class="text-xs font-bold text-gray-300">관리자</span>
                <button onclick="logout()" class="ml-2 w-6 h-6 flex items-center justify-center rounded-full hover:bg-white/10 text-gray-400 hover:text-red-400 transition-colors" title="로그아웃">
                    <i class="fas fa-sign-out-alt text-xs"></i>
                </button>
            </div>
            <!-- 모바일 햄버거 버튼 -->
            <button class="lg:hidden w-10 h-10 flex items-center justify-center text-white hover:bg-white/10 rounded-full transition-colors" onclick="toggleMobileMenu(true)">
                <i class="fas fa-bars text-xl"></i>
            </button>
        </div>
    </nav>

    <!-- 모바일 메뉴 드로어 (Slide-out Menu) -->
    <div id="mobile-overlay" class="mobile-drawer-overlay" onclick="toggleMobileMenu(false)"></div>
    <div id="mobile-drawer" class="mobile-drawer">
        <div class="flex items-center justify-between mb-8">
            <span class="font-black text-lg tracking-tight"><i class="fas fa-magic text-purple-500 mr-2"></i>MENU</span>
            <button onclick="toggleMobileMenu(false)" class="text-gray-400 hover:text-white"><i class="fas fa-times text-xl"></i></button>
        </div>
        
        <div class="flex items-center gap-3 p-4 mb-6 bg-white/5 rounded-xl border border-white/5">
            <div class="w-10 h-10 rounded-full bg-purple-600 flex items-center justify-center font-bold text-sm">A</div>
            <div>
                <div class="font-bold text-sm text-white">Administrator</div>
                <div class="text-[10px] text-gray-400">Master Access</div>
            </div>
        </div>

        <div class="flex-1 space-y-1">
            <div class="drawer-item active" onclick="showSection('dashboard', this)">
                <i class="fas fa-chart-pie w-5"></i> 대시보드
            </div>
            <div class="drawer-item" onclick="showSection('projects', this)">
                <i class="fas fa-tasks w-5"></i> 프로젝트 관리
            </div>
            <div class="drawer-item" onclick="showSection('portfolios', this)">
                <i class="fas fa-briefcase w-5"></i> 포트폴리오
            </div>
            <div class="drawer-item" onclick="showSection('quotes', this)">
                <i class="fas fa-file-invoice-dollar w-5"></i> 견적 문의
            </div>
            <div class="drawer-item" onclick="showSection('deposits', this)">
                <i class="fas fa-credit-card w-5"></i> 결제 현황
            </div>
            <div class="drawer-item" onclick="showSection('site-config', this)">
                <i class="fas fa-sliders-h w-5"></i> 사이트 설정
            </div>
            
            <div class="my-4 border-t border-white/5"></div>
            
            <!-- 모바일 로그아웃 버튼 -->
            <div class="drawer-item text-red-400 hover:text-red-300 hover:bg-red-500/10" onclick="logout()">
                <i class="fas fa-sign-out-alt w-5"></i> 로그아웃
            </div>
        </div>

        <div class="pt-6 border-t border-white/10 text-[10px] text-gray-500 text-center">
            HANRORO ADMIN SYSTEM v2.0
        </div>
    </div>

    <!-- 히어로 섹션 (Index.html과 동일한 디자인 & 메모리 최적화 적용) -->
    <section class="min-h-screen flex items-center pt-24 pb-20 relative overflow-hidden bg-[#05020a]">
        <!-- Magic Neon Rain Canvas (Optimized) -->
        <canvas id="magic-rain" class="magic-rain-canvas"></canvas>
        
        <!-- Large Sharp 3D Wand (No Filter Drop-Shadow) -->
        <div class="hero-wand-container">
            <i class="fas fa-magic hero-wand-3d"></i>
        </div>
        
        <!-- Bottom Fade -->
        <div class="absolute bottom-0 left-0 w-full h-32 bg-gradient-to-t from-[#05020a] via-[#05020a] to-transparent z-[5] pointer-events-none"></div>

        <div class="max-w-7xl mx-auto px-6 w-full relative z-10 pointer-events-none">
            <div class="inline-flex items-center px-4 py-1.5 mb-8 rounded-full border border-purple-500/30 bg-purple-500/10 text-purple-300 text-[10px] font-black uppercase tracking-[0.2em] pointer-events-auto">
                <i class="fas fa-shield-alt mr-2"></i> Administrator Console
            </div>
            <h1 class="text-3xl sm:text-5xl font-black leading-[1.15] mb-8 sm:mb-10 tracking-tighter pointer-events-auto">
                시스템 관리 및 <br>
                <span class="gradient-text italic">데이터 컨트롤 타워</span>
            </h1>
            <p class="text-white mb-10 sm:mb-12 text-base sm:text-lg max-w-xl leading-relaxed font-medium pointer-events-auto">
                실시간 프로젝트 모니터링, 견적 문의 확인, 그리고 사이트 설정을 위한 통합 대시보드입니다. 모든 변경사항은 즉시 반영됩니다.
            </p>
            <div class="flex flex-wrap items-center gap-4 pointer-events-auto">
                <button onclick="showSection('projects', document.querySelectorAll('.nav-item')[1])" class="bg-white text-black px-7 sm:px-8 py-3.5 sm:py-4 rounded-2xl font-black text-sm uppercase tracking-tight hover:bg-gray-200 transition-colors">
                    프로젝트 관리
                </button>
                <button onclick="showSection('deposits', document.querySelectorAll('.nav-item')[4])" class="px-7 sm:px-8 py-3.5 sm:py-4 rounded-2xl font-black text-sm uppercase tracking-tight border border-white/20 bg-white/5 backdrop-blur-md text-white hover:bg-white/10 transition-all flex items-center gap-2">
                    <i class="fas fa-credit-card text-purple-400"></i> 결제 현황 확인
                </button>

                <div class="flex items-center gap-4 px-5 py-3.5 sm:px-6 sm:py-4 rounded-2xl border border-white/10 bg-white/5 backdrop-blur-md">
                    <div class="flex -space-x-2">
                        <div class="w-6 h-6 rounded-full border-2 border-black bg-green-500 animate-pulse"></div>
                    </div>
                    <span class="text-[11px] font-bold text-gray-300">System Online</span>
                </div>
            </div>
        </div>
    </section>

    <!-- 메인 콘텐츠 영역 -->
    <main class="relative z-20 max-w-7xl mx-auto px-4 sm:px-6 -mt-10 pb-20">
        <!-- (기존 콘텐츠 섹션들 유지) -->
        
        <!-- 1. 대시보드 개요 섹션 -->
        <div id="section-dashboard" class="content-section space-y-8">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="glass-panel p-6 rounded-2xl relative overflow-hidden group hover:-translate-y-1 transition-transform">
                    <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:scale-110 transition-transform"><i class="fas fa-project-diagram text-6xl"></i></div>
                    <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-2">Active Projects</p>
                    <h3 class="text-4xl font-black" id="stat-active-projects">-</h3>
                    <div class="mt-4 text-[10px] text-gray-500 font-bold">진행 중인 프로젝트</div>
                </div>
                <div class="glass-panel p-6 rounded-2xl relative overflow-hidden group hover:-translate-y-1 transition-transform">
                    <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:scale-110 transition-transform"><i class="fas fa-envelope-open text-6xl"></i></div>
                    <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-2">New Inquiries</p>
                    <h3 class="text-4xl font-black text-purple-400" id="stat-new-quotes">-</h3>
                    <div class="mt-4 text-[10px] text-gray-500 font-bold">신규 견적 문의</div>
                </div>
                <div class="glass-panel p-6 rounded-2xl relative overflow-hidden group hover:-translate-y-1 transition-transform">
                    <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:scale-110 transition-transform"><i class="fas fa-coins text-6xl"></i></div>
                    <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-2">Pending Payments</p>
                    <h3 class="text-4xl font-black text-yellow-500" id="stat-pending-deposits">-</h3>
                    <div class="mt-4 text-[10px] text-gray-500 font-bold">입금 확인 대기</div>
                </div>
                <div class="glass-panel p-6 rounded-2xl flex flex-col justify-center items-center gap-3 border-dashed border-2 border-white/10 hover:border-purple-500/50 cursor-pointer transition-colors" onclick="showSection('site-config', document.querySelectorAll('.nav-item')[5])">
                    <i class="fas fa-sliders-h text-2xl text-purple-500"></i>
                    <span class="text-xs font-bold uppercase tracking-wider">사이트 설정 바로가기</span>
                </div>
            </div>
        </div>

        <!-- 나머지 섹션들은 기존 코드 유지 (생략 없이 포함되어야 함) -->
        <!-- 2. 프로젝트 관리 -->
        <div id="section-projects" class="content-section hidden">
            <!-- (기존 프로젝트 관리 코드) -->
             <h2 class="section-title"><i class="fas fa-tasks"></i> 프로젝트 관리</h2>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- 프로젝트 폼 -->
                <div class="lg:col-span-1">
                    <div class="glass-panel p-6 rounded-2xl sticky top-24">
                        <h3 class="text-sm font-bold text-white mb-4 uppercase tracking-wider flex justify-between items-center">
                            <span id="p-form-title">새 프로젝트 등록</span>
                            <button onclick="resetProjectForm()" class="text-[10px] text-gray-400 hover:text-white hidden" id="p-form-reset"><i class="fas fa-undo mr-1"></i>취소</button>
                        </h3>
                        <form id="project-form" class="space-y-4">
                            <input type="hidden" id="p-id">
                            <div>
                                <label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">프로젝트명</label>
                                <input type="text" id="p-name" class="custom-input" placeholder="예: 한로로 웹사이트 리뉴얼" required>
                            </div>
                            <div>
                                <label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">진행 단계 (Phase)</label>
                                <select id="p-phase" class="custom-input bg-[#1a1625]">
                                    <option value="상담">상담 (Consulting)</option>
                                    <option value="계약">계약 (Contract)</option>
                                    <option value="기획">기획 (Planning)</option>
                                    <option value="디자인">디자인 (Design)</option>
                                    <option value="퍼블리싱">퍼블리싱 (Publishing)</option>
                                    <option value="개발">개발 (Development)</option>
                                    <option value="테스트">테스트 (QA)</option>
                                    <option value="배포">배포 (Deploy)</option>
                                    <option value="최종 배포 완료">최종 배포 완료 (Final Deployment Complete)</option>
                                    <option value="유지보수">유지보수 (Maintenance)</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">진행률 (%)</label>
                                <div class="flex items-center gap-3">
                                    <input type="range" id="p-progress" min="0" max="100" value="0" class="flex-1 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-500" oninput="document.getElementById('p-prog-val').innerText = this.value + '%'">
                                    <span id="p-prog-val" class="text-xs font-bold w-10 text-right">0%</span>
                                </div>
                            </div>
                            <button type="submit" id="p-submit-btn" class="w-full bg-purple-600 hover:bg-purple-500 text-white font-bold py-3 rounded-xl transition-colors text-xs uppercase tracking-widest mt-2">프로젝트 추가</button>
                        </form>
                    </div>
                </div>
                <!-- 프로젝트 리스트 -->
                <div class="lg:col-span-2 space-y-4" id="project-manage-list">
                    <div class="text-center py-10 text-gray-500 text-xs">데이터 로딩 중...</div>
                </div>
            </div>
        </div>

        <!-- 3. 포트폴리오 관리 -->
        <div id="section-portfolios" class="content-section hidden">
            <div class="flex items-center justify-between mb-6">
                <h2 class="section-title !mb-0"><i class="fas fa-briefcase"></i> 포트폴리오 관리</h2>
                <button onclick="openPortfolioModal('add')" class="bg-white/10 hover:bg-white/20 border border-white/20 text-white px-4 py-2 rounded-xl text-xs font-bold transition-all flex items-center gap-2">
                    <i class="fas fa-plus"></i> 포트폴리오 추가
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6" id="portfolio-manage-list">
                <div class="col-span-full text-center py-10 text-gray-500 text-xs">데이터 로딩 중...</div>
            </div>
        </div>

        <!-- 4. 견적 문의 내역 -->
        <div id="section-quotes" class="content-section hidden">
            <h2 class="section-title"><i class="fas fa-file-invoice-dollar"></i> 견적 문의 내역</h2>
            <div class="glass-panel rounded-2xl overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr>
                                <th class="table-head p-4">접수일</th>
                                <th class="table-head p-4">분류</th>
                                <th class="table-head p-4">고객명</th>
                                <th class="table-head p-4">연락처</th>
                                <th class="table-head p-4">문의 내용</th>
                                <th class="table-head p-4 w-24 text-right">관리</th>
                            </tr>
                        </thead>
                        <tbody id="quote-table-body" class="text-sm text-gray-300"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 5. 결제/입금 현황 -->
        <div id="section-deposits" class="content-section hidden">
            <div class="flex items-center justify-between mb-6">
                <h2 class="section-title !mb-0"><i class="fas fa-won-sign"></i> 결제 및 입금 현황</h2>
                <button onclick="openDepositModal('add')" class="bg-white/10 hover:bg-white/20 border border-white/20 text-white px-4 py-2 rounded-xl text-xs font-bold transition-all flex items-center gap-2">
                    <i class="fas fa-plus"></i> 수기 등록
                </button>
            </div>
            
            <!-- Desktop Table View -->
            <div class="glass-panel rounded-2xl overflow-hidden hidden md:block">
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr>
                                <th class="table-head p-4">신청일</th>
                                <th class="table-head p-4">상품 유형</th>
                                <th class="table-head p-4">입금자명</th>
                                <th class="table-head p-4">연락처</th>
                                <th class="table-head p-4">상태</th>
                                <th class="table-head p-4 w-24 text-right">관리</th>
                            </tr>
                        </thead>
                        <tbody id="deposit-table-body" class="text-sm text-gray-300"></tbody>
                    </table>
                </div>
            </div>
            <!-- Mobile Card View -->
            <div id="deposit-mobile-list" class="grid grid-cols-1 gap-4 md:hidden"></div>
        </div>

        <!-- 6. 사이트 설정 섹션 -->
        <div id="section-site-config" class="content-section hidden">
            <h2 class="section-title"><i class="fas fa-sliders-h"></i> 사이트 설정 (CMS)</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- 상단 팝업 설정 -->
                <div class="glass-panel p-6 rounded-2xl">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-sm font-bold text-white uppercase tracking-wider">상단 네온 알림바</h3>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="conf-top-show" class="sr-only peer">
                            <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                        </label>
                    </div>
                    <div class="space-y-3">
                        <div>
                            <label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">알림 텍스트</label>
                            <input type="text" id="conf-top-text" class="custom-input" placeholder="예: 제작 비용 60% 자체 할인 이벤트 중">
                        </div>
                    </div>
                </div>

                <!-- 하단 팝업 설정 -->
                <div class="glass-panel p-6 rounded-2xl">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-sm font-bold text-white uppercase tracking-wider">하단 플로팅 배너</h3>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="conf-bottom-show" class="sr-only peer">
                            <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                        </label>
                    </div>
                    <div class="space-y-3">
                        <div>
                            <label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">메인 타이틀</label>
                            <input type="text" id="conf-bottom-title" class="custom-input" placeholder="예: 제작 비용 60% 자체 할인 진행 중">
                        </div>
                        <div>
                            <label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">서브 텍스트 (작은 글씨)</label>
                            <input type="text" id="conf-bottom-sub" class="custom-input" placeholder="예: Limited Offer">
                        </div>
                    </div>
                </div>

                <!-- 공지사항 설정 -->
                <div class="glass-panel p-6 rounded-2xl lg:col-span-2">
                    <h3 class="text-sm font-bold text-white uppercase tracking-wider mb-4">하단 공지사항 (Notice Ticker)</h3>
                    <div class="space-y-3">
                        <div>
                            <label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">공지 텍스트</label>
                            <input type="text" id="conf-notice-text" class="custom-input" placeholder="예: 환영합니다! 한로로 공식 웹사이트입니다.">
                        </div>
                    </div>
                </div>
            </div>
            
            <button id="save-config-btn" class="w-full mt-6 bg-purple-600 hover:bg-purple-500 text-white font-bold py-4 rounded-xl transition-colors text-xs uppercase tracking-widest shadow-lg shadow-purple-600/20">
                <i class="fas fa-save mr-2"></i> 설정 전체 저장하기
            </button>
        </div>
    </main>

    <!-- ADMIN MODALS (포트폴리오, 견적, 입금) -->
    <!-- 1. 포트폴리오 관리 Modal -->
    <div id="modal-portfolio" class="admin-modal" onclick="if(event.target === this) closeAdminModal('modal-portfolio')">
        <div class="admin-modal-content !max-w-[700px]">
            <h3 class="text-lg font-bold mb-4 flex justify-between">
                <span id="pf-modal-title">포트폴리오 추가</span>
                <button onclick="closeAdminModal('modal-portfolio')"><i class="fas fa-times text-gray-400"></i></button>
            </h3>
            <form id="portfolio-modal-form" class="space-y-4">
                <input type="hidden" id="pf-id">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">프로젝트 제목</label>
                        <input type="text" id="pf-title-input" class="custom-input" placeholder="예: 라이트하우스 블로그" required>
                    </div>
                    <div>
                        <label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">카테고리</label>
                        <input type="text" id="pf-category-input" class="custom-input" placeholder="예: Basic Web / Blog Type" required>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">클라이언트</label>
                        <input type="text" id="pf-client-input" class="custom-input" placeholder="예: Lighthouse Inc." required>
                    </div>
                    <div>
                        <label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">제작 연도</label>
                        <input type="text" id="pf-year-input" class="custom-input" placeholder="예: 2024" required>
                    </div>
                </div>
                <div>
                    <label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">이미지 URL</label>
                    <input type="url" id="pf-image-input" class="custom-input" placeholder="https://example.com/image.jpg (이미지 주소 입력)" required>
                    <p class="text-[10px] text-gray-500 mt-1">* 이미지 호스팅 URL을 입력해주세요.</p>
                </div>
                <div>
                    <label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">상세 설명</label>
                    <textarea id="pf-desc-input" class="custom-input h-24 resize-none" placeholder="프로젝트에 대한 설명을 입력하세요."></textarea>
                </div>
                <div>
                    <label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">외부 링크 (선택)</label>
                    <input type="url" id="pf-link-input" class="custom-input" placeholder="https://...">
                </div>
                <button type="submit" class="w-full bg-purple-600 hover:bg-purple-500 text-white font-bold py-3 rounded-xl transition-colors text-xs uppercase tracking-widest">저장하기</button>
            </form>
        </div>
    </div>

    <!-- 2. 견적 문의 Modal -->
    <div id="modal-quote" class="admin-modal" onclick="if(event.target === this) closeAdminModal('modal-quote')">
        <div class="admin-modal-content !p-0 overflow-hidden">
             <!-- Header -->
             <div class="p-6 sm:p-8 bg-gradient-to-br from-purple-900/40 to-transparent border-b border-white/5 relative">
                <div class="flex justify-between items-start">
                    <div>
                        <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-purple-500/20 text-purple-400 text-[9px] font-black uppercase tracking-widest mb-3">
                            <i class="fas fa-edit"></i> Edit Mode
                        </div>
                        <h3 class="text-2xl sm:text-3xl font-black text-white uppercase tracking-tighter" id="mq-title">견적 상세 및 수정</h3>
                    </div>
                    <button onclick="closeAdminModal('modal-quote')" class="w-9 h-9 sm:w-10 h-10 rounded-full bg-white/5 flex items-center justify-center text-gray-400 hover:text-white">
                        <i class="fas fa-times text-sm"></i>
                    </button>
                </div>
            </div>
            <!-- Body -->
            <div class="p-6 sm:p-8">
                <form id="quote-modal-form" class="space-y-5 sm:space-y-6">
                    <input type="hidden" id="mq-id">
                     <!-- Category Selection (Cards) -->
                     <div class="space-y-3">
                        <label class="text-[9px] font-black text-gray-500 uppercase tracking-[0.2em] ml-1">Project Category</label>
                        <div class="grid grid-cols-2 gap-3">
                            <label class="block relative">
                                <input type="radio" name="mq-category" value="일반" class="hidden option-radio" checked>
                                <div class="option-card p-3 sm:p-4 rounded-xl flex items-center gap-3">
                                    <div class="w-8 h-8 rounded-lg bg-purple-600/20 flex items-center justify-center text-purple-400">
                                        <i class="fas fa-user text-xs sm:text-sm"></i>
                                    </div>
                                    <h4 class="text-[11px] sm:text-xs font-bold text-white uppercase tracking-tight">일반</h4>
                                </div>
                            </label>
                            <label class="block relative">
                                <input type="radio" name="mq-category" value="기업" class="hidden option-radio">
                                <div class="option-card p-3 sm:p-4 rounded-xl flex items-center gap-3">
                                    <div class="w-8 h-8 rounded-lg bg-purple-600/20 flex items-center justify-center text-purple-400">
                                        <i class="fas fa-building text-xs sm:text-sm"></i>
                                    </div>
                                    <h4 class="text-[11px] sm:text-xs font-bold text-white uppercase tracking-tight">기업</h4>
                                </div>
                            </label>
                        </div>
                    </div>
                    <!-- Inputs -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-5">
                        <div class="space-y-2">
                            <label class="text-[9px] font-black text-gray-500 uppercase tracking-[0.2em] ml-1">Name / Company</label>
                            <input type="text" id="mq-name" class="custom-input !mt-0 !py-3 bg-white/5 border-white/10" placeholder="성함 또는 업체명" required>
                        </div>
                        <div class="space-y-2">
                            <label class="text-[9px] font-black text-gray-500 uppercase tracking-[0.2em] ml-1">Contact Number</label>
                            <input type="text" id="mq-contact" class="custom-input !mt-0 !py-3 bg-white/5 border-white/10" placeholder="010-0000-0000" required>
                        </div>
                    </div>
                    <!-- Textarea -->
                    <div class="space-y-2">
                        <label class="text-[9px] font-black text-gray-500 uppercase tracking-[0.2em] ml-1">Project Message</label>
                        <textarea id="mq-content" class="custom-input h-64 sm:h-80 resize-y !mt-0 !py-3 bg-white/5 border-white/10 leading-relaxed" placeholder="내용을 입력해 주세요."></textarea>
                    </div>
                    <button type="submit" class="w-full bg-purple-600 text-white py-4 sm:py-5 rounded-2xl font-black text-xs sm:text-sm uppercase tracking-[0.2em] hover:bg-purple-700 transition-all shadow-lg shadow-purple-600/30">
                        저장하기
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- 3. 입금 내역 Modal -->
    <div id="modal-deposit" class="admin-modal" onclick="if(event.target === this) closeAdminModal('modal-deposit')">
        <div class="admin-modal-content">
            <h3 class="text-lg font-bold mb-4 flex justify-between">
                <span id="md-title">입금 내역 등록</span>
                <button onclick="closeAdminModal('modal-deposit')"><i class="fas fa-times text-gray-400"></i></button>
            </h3>
            <form id="deposit-modal-form" class="space-y-4">
                <input type="hidden" id="md-id">
                <div>
                    <label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">상품 유형</label>
                    <input type="text" id="md-type" class="custom-input" placeholder="예: 구글 호스팅" required>
                </div>
                <div>
                    <label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">입금자명</label>
                    <input type="text" id="md-name" class="custom-input" required>
                </div>
                <div>
                    <label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">연락처</label>
                    <input type="text" id="md-phone" class="custom-input" required>
                </div>
                <div>
                    <label class="text-[10px] text-gray-500 uppercase font-bold block mb-1">상태</label>
                    <select id="md-status" class="custom-input bg-[#1a1625]">
                        <option value="pending">입금대기 (Pending)</option>
                        <option value="complete">입금완료 (Complete)</option>
                    </select>
                </div>
                <button type="submit" class="w-full bg-purple-600 hover:bg-purple-500 text-white font-bold py-3 rounded-xl transition-colors text-xs uppercase tracking-widest">저장하기</button>
            </form>
        </div>
    </div>


    <!-- Magic Rain Canvas Script (사파리 최적화) -->
    <script>
        (function() {
            const canvas = document.getElementById('magic-rain');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            let width, height;
            let particles = [];

            function resize() {
                width = canvas.width = window.innerWidth;
                height = canvas.height = window.innerHeight;
            }
            window.addEventListener('resize', resize);
            resize();

            class Particle {
                constructor() {
                    this.x = Math.random() * width;
                    this.y = Math.random() * -height; 
                    this.speed = Math.random() * 2 + 1.5; 
                    this.width = Math.random() * 2 + 1; 
                    this.color = `hsla(${Math.random() * 60 + 250}, 80%, 65%, 0.8)`;
                }
                update() {
                    this.y += this.speed;
                    if (this.y > height) {
                        this.y = Math.random() * -100;
                        this.x = Math.random() * width;
                    }
                }
                draw() {
                    ctx.beginPath();
                    ctx.fillStyle = this.color;
                    ctx.fillRect(this.x, this.y, this.width, 10);
                    ctx.closePath();
                }
            }

            function initParticles() {
                particles = [];
                const particleCount = Math.floor(width / 15);
                for (let i = 0; i < particleCount; i++) {
                    particles.push(new Particle());
                }
            }
            initParticles();

            function animate() {
                ctx.fillStyle = 'rgba(5, 2, 10, 0.15)'; 
                ctx.fillRect(0, 0, width, height);
                // Safari Fix: Remove lighter globalCompositeOperation
                particles.forEach(p => {
                    p.update();
                    p.draw();
                });
                requestAnimationFrame(animate);
            }
            animate();
        })();
    </script>

    <!-- Firebase Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, collection, onSnapshot, addDoc, updateDoc, deleteDoc, doc, serverTimestamp, setDoc, orderBy, query, getDoc } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
        
        const firebaseConfig = { 
            apiKey: "AIzaSyBkWgHnnHTKaOfHmgt7P-OwptraKcwEXvI", 
            authDomain: "hanroro-web.firebaseapp.app", 
            projectId: "hanroro-web", 
            appId: "1:461514865624:web:4ab6ad23c2e771b426d0ad" 
        };
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const currentAppId = "hanroro-official-service";

        // Login Logic
        const CORRECT_PASSCODE = "gksfhfh00@@";
        const loginOverlay = document.getElementById('login-overlay');
        const loginForm = document.getElementById('login-form');
        const passInput = document.getElementById('passcode-input');
        const loginError = document.getElementById('login-error');

        if(sessionStorage.getItem('admin_authenticated') === 'true') {
            loginOverlay.classList.add('hidden');
            document.body.classList.remove('overflow-hidden');
        }

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            if(passInput.value === CORRECT_PASSCODE) {
                sessionStorage.setItem('admin_authenticated', 'true');
                loginOverlay.classList.add('hidden');
                document.body.classList.remove('overflow-hidden');
            } else {
                loginError.classList.remove('hidden');
                loginOverlay.querySelector('.glass-panel').classList.add('shake');
                setTimeout(() => loginOverlay.querySelector('.glass-panel').classList.remove('shake'), 500);
            }
        });

        window.logout = () => {
            if(confirm('관리자 모드에서 로그아웃 하시겠습니까?')) {
                sessionStorage.removeItem('admin_authenticated');
                location.reload();
            }
        }


        let editingProjectId = null;
        let editingQuoteId = null;
        let editingDepositId = null;
        let editingPortfolioId = null;

        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log("Admin Logged In");
                initDashboard();
            } else {
                signInAnonymously(auth).catch(console.error);
            }
        });

        function initDashboard() {
            // 1. Projects
            const projectCol = collection(db, 'artifacts', currentAppId, 'public', 'data', 'projects');
            const qProjects = query(projectCol, orderBy('createdAt', 'desc'));
            onSnapshot(projectCol, (snap) => {
                const listEl = document.getElementById('project-manage-list');
                const projects = [];
                let html = '';
                snap.forEach(d => {
                    const p = d.data();
                    projects.push(p);
                    const safeData = JSON.stringify({id: d.id, ...p}).replace(/"/g, '&quot;');
                    html += `
                    <div class="glass-panel p-4 rounded-xl flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                        <div class="flex-1 w-full">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-[10px] font-bold px-2 py-0.5 rounded bg-purple-500/20 text-purple-300 border border-purple-500/20 uppercase">${p.phase}</span>
                                <h4 class="font-bold text-white text-sm">${p.name}</h4>
                            </div>
                            <div class="w-full bg-gray-700 h-1.5 rounded-full mt-2 overflow-hidden">
                                <div class="bg-purple-500 h-full rounded-full" style="width: ${p.progress}%"></div>
                            </div>
                            <p class="text-[10px] text-gray-400 mt-1 text-right">${p.progress}% 완료됨</p>
                        </div>
                        <div class="flex gap-2 self-end sm:self-center">
                            <button class="bg-white/5 hover:bg-white/10 text-gray-300 border border-white/10 px-3 py-2 rounded text-xs transition-colors" onclick="window.editProject(${safeData})"><i class="fas fa-edit"></i></button>
                            <button class="bg-red-500/10 hover:bg-red-500/20 text-red-400 border border-red-500/20 px-3 py-2 rounded text-xs transition-colors" onclick="window.deleteProject('${d.id}')"><i class="fas fa-trash-alt"></i></button>
                        </div>
                    </div>`;
                });
                if(!html) html = '<div class="text-center text-gray-500 py-4 text-xs">등록된 프로젝트가 없습니다.</div>';
                listEl.innerHTML = html;
                document.getElementById('stat-active-projects').innerText = projects.length;
            });

            // 2. Portfolios
            const portfolioCol = collection(db, 'artifacts', currentAppId, 'public', 'data', 'portfolios');
            const qPortfolios = query(portfolioCol, orderBy('createdAt', 'desc'));
            onSnapshot(portfolioCol, (snap) => {
                const listEl = document.getElementById('portfolio-manage-list');
                let html = '';
                snap.forEach(d => {
                    const pf = d.data();
                    const safeData = JSON.stringify({id: d.id, ...pf}).replace(/"/g, '&quot;');
                    const imgStyle = pf.imageUrl ? `background-image: url('${pf.imageUrl}')` : 'background-color: #2d2d2d';
                    html += `
                    <div class="glass-panel p-4 rounded-xl flex flex-col gap-4 group">
                        <div class="w-full aspect-video rounded-lg bg-cover bg-center border border-white/10 relative overflow-hidden" style="${imgStyle}">
                            <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2">
                                <button onclick="window.openPortfolioModal('edit', null, ${safeData})" class="bg-white text-black w-8 h-8 rounded-full flex items-center justify-center hover:scale-110 transition-transform"><i class="fas fa-edit text-xs"></i></button>
                                <button onclick="window.deletePortfolio('${d.id}')" class="bg-red-500 text-white w-8 h-8 rounded-full flex items-center justify-center hover:scale-110 transition-transform"><i class="fas fa-trash text-xs"></i></button>
                            </div>
                        </div>
                        <div>
                            <div class="text-[10px] text-purple-400 font-bold uppercase tracking-widest mb-1 truncate">${pf.category}</div>
                            <h4 class="font-bold text-white text-sm truncate">${pf.title}</h4>
                            <p class="text-[10px] text-gray-500 mt-1 truncate">${pf.client} | ${pf.year}</p>
                        </div>
                    </div>`;
                });
                if(!html) html = '<div class="col-span-full text-center py-10 text-gray-500 text-xs">등록된 포트폴리오가 없습니다.</div>';
                listEl.innerHTML = html;
            });

            // 3. Quotes
            const quoteCol = collection(db, 'artifacts', currentAppId, 'public', 'data', 'quotes');
            onSnapshot(quoteCol, (snap) => {
                // Update Badges for Desktop & Mobile
                const count = snap.size;
                // Add badge spans in HTML first (added in nav)
                // ...
                const tbody = document.getElementById('quote-table-body');
                let html = '';
                let newCount = 0;
                snap.forEach(d => {
                    newCount++;
                    const q = d.data();
                    const safeData = JSON.stringify({id: d.id, ...q}).replace(/"/g, '&quot;');
                    const date = q.createdAt ? new Date(q.createdAt.seconds * 1000).toLocaleDateString() : '-';
                    html += `
                    <tr class="table-row">
                        <td class="p-4 text-gray-400 font-mono text-xs">${date}</td>
                        <td class="p-4"><span class="px-2 py-1 rounded bg-white/5 border border-white/10 text-[10px] font-bold">${q.category || '일반'}</span></td>
                        <td class="p-4 font-bold text-white">${q.name}</td>
                        <td class="p-4 text-gray-400">${q.contact}</td>
                        <td class="p-4 text-gray-400 truncate max-w-xs cursor-pointer hover:text-white" title="클릭하여 상세 보기" onclick="window.openQuoteModal('edit', null, ${safeData})">${q.content}</td>
                        <td class="p-4 text-right">
                             <div class="flex justify-end gap-2">
                                <button class="text-gray-400 hover:text-white px-2" onclick="window.openQuoteModal('edit', null, ${safeData})" title="수정"><i class="fas fa-edit"></i></button>
                                <button class="text-gray-400 hover:text-red-400 px-2" onclick="window.deleteQuote('${d.id}')" title="삭제"><i class="fas fa-trash"></i></button>
                            </div>
                        </td>
                    </tr>`;
                });
                tbody.innerHTML = html || '<tr><td colspan="6" class="p-6 text-center text-gray-500 text-xs">문의 내역이 없습니다.</td></tr>';
                document.getElementById('stat-new-quotes').innerText = newCount;
            });

            // 4. Deposits
            const depositCol = collection(db, 'artifacts', currentAppId, 'public', 'data', 'deposits');
            onSnapshot(depositCol, (snap) => {
                const tbody = document.getElementById('deposit-table-body');
                const mobileList = document.getElementById('deposit-mobile-list');
                let tableHtml = '';
                let mobileHtml = '';
                let pendingCount = 0;
                snap.forEach(d => {
                    const dep = d.data();
                    const isComplete = dep.status === 'complete' || dep.status === '입금완료';
                    if(!isComplete) pendingCount++;
                    const date = dep.createdAt ? new Date(dep.createdAt.seconds * 1000).toLocaleDateString() : '-';
                    const safeData = JSON.stringify({id: d.id, ...dep}).replace(/"/g, '&quot;');
                    
                    // Table
                    tableHtml += `
                    <tr class="table-row">
                        <td class="p-4 text-gray-400 font-mono text-xs">${date}</td>
                        <td class="p-4 text-xs text-purple-300 font-bold">${dep.type}</td>
                        <td class="p-4 font-bold text-white">${dep.name}</td>
                        <td class="p-4 text-gray-400">${dep.phone}</td>
                        <td class="p-4"><span class="status-badge ${isComplete ? 'status-complete' : 'status-pending'}">${isComplete ? '입금완료' : '입금대기'}</span></td>
                        <td class="p-4 text-right">
                            <div class="flex justify-end gap-2">
                                <button class="text-gray-400 hover:text-white px-2" onclick="window.openDepositModal('edit', null, ${safeData})"><i class="fas fa-edit"></i></button>
                                <button class="text-gray-400 hover:text-red-400 px-2" onclick="window.deleteDeposit('${d.id}')"><i class="fas fa-trash"></i></button>
                            </div>
                        </td>
                    </tr>`;

                    // Mobile
                    const statusText = isComplete ? '입금완료' : '입금대기';
                    const statusClass = isComplete ? 'text-purple-400 border-purple-500/40' : 'text-yellow-500 border-yellow-500/40';
                    let displayType = dep.type || '서비스';
                    let planIcon = 'fa-rocket';
                    if (displayType.includes('구글')) planIcon = 'fa-cloud';
                    else if (displayType.includes('일반')) planIcon = 'fa-server';

                    mobileHtml += `
                    <div class="unified-card group transition-all relative">
                        <div class="flex justify-between items-center mb-4">
                            <div class="flex items-center gap-2 px-2 py-1 rounded-lg bg-purple-500/10 border border-purple-500/10"><i class="fas ${planIcon} text-purple-400 text-[10px]"></i><span class="text-[9px] font-black text-purple-300 uppercase tracking-tighter">${displayType}</span></div>
                            <span class="text-[8px] font-black px-1.5 py-0.5 rounded border ${statusClass} uppercase tracking-tighter">${statusText}</span>
                        </div>
                        <div class="space-y-1 mb-3">
                            <div class="flex justify-between items-end">
                                <div><span class="text-[9px] font-bold text-gray-500 uppercase tracking-widest block">클라이언트</span><h4 class="font-bold text-white text-xs">${dep.name}</h4></div>
                                <div class="text-[10px] text-gray-400 font-mono">${date}</div>
                            </div>
                        </div>
                        <div class="flex gap-2 pt-3 border-t border-white/5">
                            <button onclick="window.openDepositModal('edit', null, ${safeData})" class="flex-1 bg-white/5 py-2 rounded text-[10px] text-gray-300 font-bold hover:bg-white/10 transition-colors"><i class="fas fa-edit mr-1"></i> 수정</button>
                            <button onclick="window.deleteDeposit('${d.id}')" class="flex-1 bg-red-500/10 py-2 rounded text-[10px] text-red-400 font-bold hover:bg-red-500/20 transition-colors"><i class="fas fa-trash mr-1"></i> 삭제</button>
                        </div>
                    </div>`;
                });
                tbody.innerHTML = tableHtml || '<tr><td colspan="6" class="p-6 text-center text-gray-500 text-xs">입금 내역이 없습니다.</td></tr>';
                mobileList.innerHTML = mobileHtml || '<div class="text-center text-gray-500 py-10 text-xs">내역이 없습니다.</div>';
                document.getElementById('stat-pending-deposits').innerText = pendingCount;
            });

            // 5. Config
            const configDocRef = doc(db, 'artifacts', currentAppId, 'public', 'data', 'configs', 'mainSettings');
            getDoc(configDocRef).then((snap) => {
                if(snap.exists()) {
                    const data = snap.data();
                    document.getElementById('conf-notice-text').value = data.noticeTitle || '';
                    document.getElementById('conf-top-show').checked = data.showTopBar !== false;
                    document.getElementById('conf-top-text').value = data.topBarText || '';
                    document.getElementById('conf-bottom-show').checked = data.showBottomBar !== false;
                    document.getElementById('conf-bottom-title').value = data.bottomBarTitle || '';
                    document.getElementById('conf-bottom-sub').value = data.bottomBarSub || '';
                }
            });

            document.getElementById('save-config-btn').addEventListener('click', async () => {
                const noticeTitle = document.getElementById('conf-notice-text').value;
                const showTopBar = document.getElementById('conf-top-show').checked;
                const topBarText = document.getElementById('conf-top-text').value;
                const showBottomBar = document.getElementById('conf-bottom-show').checked;
                const bottomBarTitle = document.getElementById('conf-bottom-title').value;
                const bottomBarSub = document.getElementById('conf-bottom-sub').value;

                try {
                    await setDoc(configDocRef, { noticeTitle, showTopBar, topBarText, showBottomBar, bottomBarTitle, bottomBarSub, updatedAt: serverTimestamp() }, { merge: true });
                    alert('사이트 설정이 저장되었습니다.');
                } catch(e) { alert('저장 실패: ' + e.message); }
            });
        }

        // Functions (Project, Portfolio, Quote, Deposit)
        document.getElementById('project-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('p-name').value;
            const phase = document.getElementById('p-phase').value;
            const progress = parseInt(document.getElementById('p-progress').value);
            const id = document.getElementById('p-id').value;
            try {
                if(id) await updateDoc(doc(db, 'artifacts', currentAppId, 'public', 'data', 'projects', id), { name, phase, progress });
                else await addDoc(collection(db, 'artifacts', currentAppId, 'public', 'data', 'projects'), { name, phase, progress, createdAt: serverTimestamp() });
                alert('저장되었습니다.');
                resetProjectForm();
            } catch(err) { alert('실패: ' + err.message); }
        });

        window.editProject = (data) => {
            document.getElementById('p-id').value = data.id;
            document.getElementById('p-name').value = data.name;
            document.getElementById('p-phase').value = data.phase;
            document.getElementById('p-progress').value = data.progress;
            document.getElementById('p-prog-val').innerText = data.progress + "%";
            document.getElementById('p-form-title').innerText = "프로젝트 수정";
            document.getElementById('p-submit-btn').innerText = "변경사항 저장";
            document.getElementById('p-form-reset').classList.remove('hidden');
            document.getElementById('project-form').scrollIntoView({ behavior: 'smooth', block: 'center' });
        };

        window.resetProjectForm = () => {
            document.getElementById('project-form').reset();
            document.getElementById('p-id').value = "";
            document.getElementById('p-progress').value = 0;
            document.getElementById('p-prog-val').innerText = "0%";
            document.getElementById('p-form-title').innerText = "새 프로젝트 등록";
            document.getElementById('p-submit-btn').innerText = "프로젝트 추가";
            document.getElementById('p-form-reset').classList.add('hidden');
        };

        window.deleteProject = async (id) => { if(confirm('삭제하시겠습니까?')) await deleteDoc(doc(db, 'artifacts', currentAppId, 'public', 'data', 'projects', id)); };

        // Portfolio
        window.openPortfolioModal = (mode, _, data = null) => {
            const modal = document.getElementById('modal-portfolio');
            const title = document.getElementById('pf-modal-title');
            if(mode === 'edit' && data) {
                editingPortfolioId = data.id;
                title.innerText = "포트폴리오 수정";
                document.getElementById('pf-id').value = data.id;
                document.getElementById('pf-title-input').value = data.title;
                document.getElementById('pf-category-input').value = data.category;
                document.getElementById('pf-client-input').value = data.client;
                document.getElementById('pf-year-input').value = data.year;
                document.getElementById('pf-image-input').value = data.imageUrl || '';
                document.getElementById('pf-desc-input').value = data.description || '';
                document.getElementById('pf-link-input').value = data.linkUrl || '';
            } else {
                editingPortfolioId = null;
                title.innerText = "포트폴리오 추가";
                document.getElementById('portfolio-modal-form').reset();
                document.getElementById('pf-id').value = "";
            }
            modal.classList.add('active');
        };

        document.getElementById('portfolio-modal-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const pfData = {
                title: document.getElementById('pf-title-input').value,
                category: document.getElementById('pf-category-input').value,
                client: document.getElementById('pf-client-input').value,
                year: document.getElementById('pf-year-input').value,
                imageUrl: document.getElementById('pf-image-input').value,
                description: document.getElementById('pf-desc-input').value,
                linkUrl: document.getElementById('pf-link-input').value
            };
            try {
                if(editingPortfolioId) await updateDoc(doc(db, 'artifacts', currentAppId, 'public', 'data', 'portfolios', editingPortfolioId), pfData);
                else { pfData.createdAt = serverTimestamp(); await addDoc(collection(db, 'artifacts', currentAppId, 'public', 'data', 'portfolios'), pfData); }
                closeAdminModal('modal-portfolio');
            } catch(e) { alert('실패'); }
        });
        window.deletePortfolio = async (id) => { if(confirm('삭제하시겠습니까?')) await deleteDoc(doc(db, 'artifacts', currentAppId, 'public', 'data', 'portfolios', id)); };

        // Quote
        window.openQuoteModal = (mode, _, data = null) => {
            const modal = document.getElementById('modal-quote');
            const title = document.getElementById('mq-title');
            if(mode === 'edit' && data) {
                editingQuoteId = data.id;
                title.innerText = "견적 상세 및 수정";
                document.getElementById('mq-id').value = data.id;
                const category = data.category || '일반';
                const radio = document.querySelector(`input[name="mq-category"][value="${category}"]`);
                if(radio) radio.checked = true;
                document.getElementById('mq-name').value = data.name;
                document.getElementById('mq-contact').value = data.contact;
                document.getElementById('mq-content').value = data.content;
            } else {
                editingQuoteId = null;
                title.innerText = "새 견적 문의 등록";
                document.getElementById('quote-modal-form').reset();
                document.getElementById('mq-id').value = "";
                const radio = document.querySelector(`input[name="mq-category"][value="일반"]`);
                if(radio) radio.checked = true;
            }
            modal.classList.add('active');
        };

        document.getElementById('quote-modal-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const categoryEl = document.querySelector('input[name="mq-category"]:checked');
            const category = categoryEl ? categoryEl.value : '일반';
            const name = document.getElementById('mq-name').value;
            const contact = document.getElementById('mq-contact').value;
            const content = document.getElementById('mq-content').value;
            try {
                if(editingQuoteId) await updateDoc(doc(db, 'artifacts', currentAppId, 'public', 'data', 'quotes', editingQuoteId), { category, name, contact, content });
                else await addDoc(collection(db, 'artifacts', currentAppId, 'public', 'data', 'quotes'), { category, name, contact, content, createdAt: serverTimestamp() });
                closeAdminModal('modal-quote');
            } catch(e) { alert('실패'); }
        });
        window.deleteQuote = async (id) => { if(confirm('삭제하시겠습니까?')) await deleteDoc(doc(db, 'artifacts', currentAppId, 'public', 'data', 'quotes', id)); };

        // Deposit
        window.openDepositModal = (mode, _, data = null) => {
            const modal = document.getElementById('modal-deposit');
            const title = document.getElementById('md-title');
            if(mode === 'edit' && data) {
                editingDepositId = data.id;
                title.innerText = "입금 내역 수정";
                document.getElementById('md-id').value = data.id;
                document.getElementById('md-type').value = data.type;
                document.getElementById('md-name').value = data.name;
                document.getElementById('md-phone').value = data.phone;
                document.getElementById('md-status').value = data.status === 'complete' || data.status === '입금완료' ? 'complete' : 'pending';
            } else {
                editingDepositId = null;
                title.innerText = "새 입금 내역 등록";
                document.getElementById('deposit-modal-form').reset();
                document.getElementById('md-id').value = "";
            }
            modal.classList.add('active');
        };

        document.getElementById('deposit-modal-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const type = document.getElementById('md-type').value;
            const name = document.getElementById('md-name').value;
            const phone = document.getElementById('md-phone').value;
            const status = document.getElementById('md-status').value;
            try {
                if(editingDepositId) await updateDoc(doc(db, 'artifacts', currentAppId, 'public', 'data', 'deposits', editingDepositId), { type, name, phone, status });
                else await addDoc(collection(db, 'artifacts', currentAppId, 'public', 'data', 'deposits'), { type, name, phone, status, createdAt: serverTimestamp() });
                closeAdminModal('modal-deposit');
            } catch(e) { alert('실패'); }
        });
        window.deleteDeposit = async (id) => { if(confirm('삭제하시겠습니까?')) await deleteDoc(doc(db, 'artifacts', currentAppId, 'public', 'data', 'deposits', id)); };

        // Utils
        window.closeAdminModal = (id) => { document.getElementById(id).classList.remove('active'); }
        window.toggleMobileMenu = (show) => {
            const drawer = document.getElementById('mobile-drawer');
            const overlay = document.getElementById('mobile-overlay');
            if(show) { drawer.classList.add('active'); overlay.classList.add('active'); document.body.style.overflow = 'hidden'; }
            else { drawer.classList.remove('active'); overlay.classList.remove('active'); document.body.style.overflow = ''; }
        }
        window.showSection = (id, element) => {
            document.querySelectorAll('.content-section').forEach(el => el.classList.add('hidden'));
            document.getElementById('section-' + id).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            const desktopNav = document.querySelector(`#desktop-menu .nav-item[onclick*="'${id}'"]`);
            if(desktopNav) desktopNav.classList.add('active');
            document.querySelectorAll('.drawer-item').forEach(el => el.classList.remove('active'));
            if(element && element.classList.contains('drawer-item')) element.classList.add('active');
            toggleMobileMenu(false);
            const heroHeight = document.querySelector('section').offsetHeight;
            window.scrollTo({ top: heroHeight - 80, behavior: 'smooth' });
        }
    </script>
</body>
</html>
