<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>한로로 대시보드 | 관리자 모드</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@100..900&display=swap');
        body { 
            font-family: 'Pretendard', sans-serif; 
            background: #05020a; 
            color: #fff; 
            margin: 0; 
            padding: 0;
            /* 텍스트 선택 방지 */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        .sidebar { background: #0c051a; border-right: 1px solid rgba(138, 79, 255, 0.1); }
        .card { background: #0f0a1f; border: 1px solid rgba(138, 79, 255, 0.1); border-radius: 1.5rem; }
        .input-field { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 0.75rem; padding: 0.75rem 1rem; color: #fff; outline: none; transition: all 0.2s; }
        .input-field:focus { border-color: #8a4fff; background: rgba(138, 79, 255, 0.05); }
        .btn-primary { background: #8a4fff; color: #fff; padding: 0.75rem 1.5rem; border-radius: 0.75rem; font-weight: 700; transition: all 0.2s; cursor: pointer; }
        .btn-primary:hover { background: #7c3aed; transform: translateY(-1px); }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #1f143d; border-radius: 10px; }
        
        /* Auth Overlay */
        #auth-overlay {
            position: fixed; inset: 0; z-index: 9999;
            background: #05020a;
            display: flex; align-items: center; justify-content: center;
        }

        /* Type Badge Styles */
        .type-badge { font-size: 10px; font-weight: 900; padding: 4px 10px; border-radius: 6px; text-transform: uppercase; letter-spacing: 0.05em; }
        .badge-landing { background: rgba(59, 130, 246, 0.15); color: #60a5fa; border: 1px solid rgba(59, 130, 246, 0.3); }
        .badge-brand { background: rgba(138, 79, 255, 0.15); color: #a78bfa; border: 1px solid rgba(138, 79, 255, 0.3); }
        .badge-commerce { background: rgba(245, 158, 11, 0.15); color: #fbbf24; border: 1px solid rgba(245, 158, 11, 0.3); }
        .badge-platform { background: rgba(16, 185, 129, 0.15); color: #34d399; border: 1px solid rgba(16, 185, 129, 0.3); }
        .badge-maintenance { background: rgba(107, 114, 128, 0.15); color: #9ca3af; border: 1px solid rgba(107, 114, 128, 0.3); }
        .badge-other { background: rgba(239, 68, 68, 0.15); color: #f87171; border: 1px solid rgba(239, 68, 68, 0.3); }
    </style>
    <script>
        // 우클릭 방지
        document.oncontextmenu = function() { return false; };

        // 단축키 차단 (F12, Ctrl+Shift+I, Ctrl+U 등)
        document.onkeydown = function(e) {
            if (e.keyCode == 123) return false; // F12
            if (e.ctrlKey && e.shiftKey && (e.keyCode == 'I'.charCodeAt(0) || e.keyCode == 'J'.charCodeAt(0) || e.keyCode == 'C'.charCodeAt(0))) return false;
            if (e.ctrlKey && (e.keyCode == 'U'.charCodeAt(0) || e.keyCode == 'S'.charCodeAt(0))) return false; // 소스보기, 저장 방지
        };
    </script>
</head>
<body class="min-h-screen flex overflow-hidden">

    <!-- Auth Overlay -->
    <div id="auth-overlay">
        <div class="card p-10 w-full max-w-md mx-4 shadow-2xl border-purple-500/20">
            <div class="text-center mb-8">
                <i class="fas fa-lock text-4xl text-purple-500 mb-4"></i>
                <h2 class="text-2xl font-black uppercase tracking-tighter">Admin Login</h2>
                <p class="text-gray-500 text-sm mt-1">접속을 위해 관리자 인증이 필요합니다.</p>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="text-xs font-bold text-gray-400 uppercase mb-2 block ml-1">ID</label>
                    <input type="text" id="auth-id" class="input-field w-full" placeholder="아이디를 입력하세요">
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-400 uppercase mb-2 block ml-1">Password</label>
                    <input type="password" id="auth-pw" class="input-field w-full" placeholder="비밀번호를 입력하세요">
                </div>
                <button onclick="handleLogin()" class="btn-primary w-full mt-4 py-4">인증하기</button>
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <aside class="sidebar w-64 flex-shrink-0 flex flex-col hidden lg:flex">
        <div class="p-8">
            <div class="flex items-center space-x-2 mb-10">
                <i class="fas fa-magic text-purple-500"></i>
                <span class="text-xl font-black tracking-tighter uppercase">HANRORO ADMIN</span>
            </div>
            <nav class="space-y-2">
                <button onclick="switchTab('projects')" class="w-full flex items-center space-x-3 px-4 py-3 rounded-xl hover:bg-white/5 transition-all text-gray-400 hover:text-white" id="nav-projects">
                    <i class="fas fa-tasks w-5"></i><span class="text-sm font-bold">프로젝트 관리</span>
                </button>
                <button onclick="switchTab('deposits')" class="w-full flex items-center space-x-3 px-4 py-3 rounded-xl hover:bg-white/5 transition-all text-gray-400 hover:text-white" id="nav-deposits">
                    <i class="fas fa-won-sign w-5"></i><span class="text-sm font-bold">입금 현황</span>
                </button>
                <button onclick="switchTab('quotes')" class="w-full flex items-center space-x-3 px-4 py-3 rounded-xl hover:bg-white/5 transition-all text-gray-400 hover:text-white" id="nav-quotes">
                    <i class="fas fa-comment-dots w-5"></i><span class="text-sm font-bold">견적/상담 신청</span>
                </button>
                <button onclick="switchTab('settings')" class="w-full flex items-center space-x-3 px-4 py-3 rounded-xl hover:bg-white/5 transition-all text-gray-400 hover:text-white" id="nav-settings">
                    <i class="fas fa-cog w-5"></i><span class="text-sm font-bold">시스템 설정</span>
                </button>
                <button onclick="handleLogout()" class="w-full flex items-center space-x-3 px-4 py-3 rounded-xl hover:bg-red-500/10 transition-all text-gray-500 hover:text-red-400 mt-10">
                    <i class="fas fa-sign-out-alt w-5"></i><span class="text-sm font-bold">로그아웃</span>
                </button>
            </nav>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-grow overflow-y-auto p-8 lg:p-12 custom-scrollbar">
        <header class="flex justify-between items-center mb-12">
            <div>
                <h1 class="text-3xl font-black mb-2" id="page-title">프로젝트 관리</h1>
                <p class="text-gray-500 text-sm" id="page-desc">현황을 관리합니다.</p>
            </div>
        </header>

        <!-- Projects Tab -->
        <div id="tab-projects" class="tab-content">
            <div class="card p-8 mb-10">
                <h3 class="text-lg font-bold mb-6 flex items-center gap-2"><i class="fas fa-plus-circle text-purple-500"></i>새 프로젝트 추가</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <input type="text" id="new-p-name" placeholder="고객명/사이트명" class="input-field">
                    <input type="text" id="new-p-phase" placeholder="현재 단계" class="input-field">
                    <input type="number" id="new-p-progress" placeholder="진행률 (%)" class="input-field">
                    <button onclick="addProject()" class="btn-primary">등록</button>
                </div>
            </div>
            <div id="project-list" class="grid gap-4"></div>
        </div>

        <!-- Deposits Tab -->
        <div id="tab-deposits" class="tab-content hidden">
            <div id="deposit-list" class="grid gap-4"></div>
        </div>

        <!-- Quotes Tab -->
        <div id="tab-quotes" class="tab-content hidden">
            <div id="quote-list" class="grid gap-4"></div>
        </div>

        <!-- Settings Tab -->
        <div id="tab-settings" class="tab-content hidden">
            <div class="card p-8 max-w-2xl">
                <h3 class="text-lg font-bold mb-6"><i class="fas fa-bullhorn text-purple-500 mr-2"></i>공지 설정</h3>
                <textarea id="notice-content" class="w-full bg-white/5 border border-white/10 p-6 rounded-2xl h-32 focus:border-purple-500 outline-none text-sm mb-4" placeholder="공지 내용"></textarea>
                <button onclick="saveSettings()" class="btn-primary w-full">저장</button>
            </div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp, onSnapshot, doc, updateDoc, deleteDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
        
        const firebaseConfig = { 
            apiKey: "AIzaSyBkWgHnnHTKaOfHmgt7P-OwptraKcwEXvI", 
            authDomain: "hanroro-web.firebaseapp.com", 
            projectId: "hanroro-web", 
            appId: "1:461514865624:web:4ab6ad23c2e771b426d0ad" 
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = "hanroro-official-service";

        // Auth Logic
        const ADMIN_ID = "hanroro";
        const ADMIN_PW = "gksfhfh00@@";

        window.handleLogin = () => {
            const id = document.getElementById('auth-id').value;
            const pw = document.getElementById('auth-pw').value;

            if (id === ADMIN_ID && pw === ADMIN_PW) {
                sessionStorage.setItem('hanroro_admin_auth', 'true');
                checkAuth();
            } else {
                alert('아이디 또는 비밀번호가 일치하지 않습니다.');
            }
        };

        window.handleLogout = () => {
            sessionStorage.removeItem('hanroro_admin_auth');
            location.reload();
        };

        const checkAuth = () => {
            const isAuthenticated = sessionStorage.getItem('hanroro_admin_auth') === 'true';
            const overlay = document.getElementById('auth-overlay');
            if (isAuthenticated) {
                overlay.style.display = 'none';
            } else {
                overlay.style.display = 'flex';
            }
        };

        checkAuth();

        const typeMap = {
            landing: { label: '랜딩페이지', class: 'badge-landing' },
            brand: { label: '브랜드 사이트', class: 'badge-brand' },
            commerce: { label: '커머스/몰', class: 'badge-commerce' },
            platform: { label: '플랫폼 제작', class: 'badge-platform' },
            maintenance: { label: '유지보수', class: 'badge-maintenance' },
            other: { label: '기타 문의', class: 'badge-other' }
        };

        window.switchTab = (tabId) => {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
            document.getElementById('tab-' + tabId).classList.remove('hidden');
            document.querySelectorAll('.sidebar button').forEach(b => b.classList.remove('bg-white/10', 'text-white'));
            document.getElementById('nav-' + tabId).classList.add('bg-white/10', 'text-white');
            
            const titles = { projects: '프로젝트 관리', deposits: '입금 현황', quotes: '견적/상담 신청', settings: '시스템 설정' };
            document.getElementById('page-title').innerText = titles[tabId];
        };

        onAuthStateChanged(auth, (user) => {
            if (user) {
                onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'projects'), (snap) => {
                    let html = '';
                    snap.forEach(d => {
                        const p = d.data();
                        html += `
                        <div class="card p-6 flex justify-between items-center">
                            <div>
                                <h4 class="font-bold">${p.name}</h4>
                                <p class="text-xs text-gray-500">${p.phase} (${p.progress}%)</p>
                            </div>
                            <button onclick="deleteItem('projects', '${d.id}')" class="text-gray-600 hover:text-red-500"><i class="fas fa-trash"></i></button>
                        </div>`;
                    });
                    document.getElementById('project-list').innerHTML = html;
                });

                onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'quotes'), (snap) => {
                    let html = '';
                    snap.forEach(d => {
                        const q = d.data();
                        const id = d.id;
                        const typeInfo = typeMap[q.type] || { label: '미분류', class: 'badge-other' };
                        html += `
                        <div class="card p-8">
                            <div class="flex flex-col md:flex-row justify-between items-start gap-4 mb-6">
                                <div>
                                    <div class="flex items-center gap-3 mb-2">
                                        <h4 class="text-xl font-black text-white">${q.name}</h4>
                                        <span class="type-badge ${typeInfo.class}">${typeInfo.label}</span>
                                    </div>
                                    <div class="flex items-center gap-4 text-sm font-bold">
                                        <span class="text-purple-400"><i class="fas fa-phone-alt mr-2"></i>${q.phone}</span>
                                        <span class="text-gray-500"><i class="far fa-clock mr-2"></i>${q.createdAt?.toDate().toLocaleString() || '시간미상'}</span>
                                    </div>
                                </div>
                                <button onclick="deleteItem('quotes', '${id}')" class="bg-red-500/10 hover:bg-red-500/20 text-red-500 p-3 rounded-xl transition-all">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                            <div class="bg-white/5 border border-white/5 p-6 rounded-2xl">
                                <p class="text-sm text-gray-300 leading-relaxed whitespace-pre-wrap">${q.memo || '상세 상담 내용이 없습니다.'}</p>
                            </div>
                        </div>`;
                    });
                    document.getElementById('quote-list').innerHTML = html || '<p class="p-10 text-center text-gray-600 italic">신규 견적 신청이 없습니다.</p>';
                });

                onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'deposits'), (snap) => {
                    let html = '';
                    snap.forEach(d => {
                        const data = d.data();
                        html += `<div class="card p-6 flex justify-between"><span>${data.name} - ${data.amount}원</span><button onclick="deleteItem('deposits', '${d.id}')" class="text-red-500"><i class="fas fa-trash"></i></button></div>`;
                    });
                    document.getElementById('deposit-list').innerHTML = html;
                });

                onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'topPopup'), (d) => {
                    if(d.exists()) document.getElementById('notice-content').value = d.data().content || '';
                });
            } else { signInAnonymously(auth); }
        });

        window.deleteItem = async (col, id) => {
            if(confirm('데이터를 삭제하시겠습니까?')) await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', col, id));
        };

        window.saveSettings = async () => {
            const content = document.getElementById('notice-content').value;
            await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'topPopup'), { content, updatedAt: serverTimestamp() });
            alert('저장되었습니다.');
        };

        switchTab('projects');
    </script>
</body>
</html>
